{
  "version": 3,
  "sources": ["../../../../../../../../../../../third_party/devtools-frontend/src/front_end/ui/legacy/components/source_frame/FontView.ts"],
  "sourcesContent": ["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as TextUtils from '../../../../models/text_utils/text_utils.js';\nimport * as VisualLogging from '../../../visual_logging/visual_logging.js';\nimport * as UI from '../../legacy.js';\n\nimport fontViewStyles from './fontView.css.legacy.js';\n\nconst UIStrings = {\n  /**\n   *@description Text that appears on a button for the font resource type filter.\n   */\n  font: 'Font',\n  /**\n   *@description Aria accessible name in Font View of the Sources panel\n   *@example {https://example.com} PH1\n   */\n  previewOfFontFromS: 'Preview of font from {PH1}',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/source_frame/FontView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class FontView extends UI.View.SimpleView {\n  private readonly url: Platform.DevToolsPath.UrlString;\n  private readonly contentProvider: TextUtils.ContentProvider.ContentProvider;\n  private readonly mimeTypeLabel: UI.Toolbar.ToolbarText;\n  fontPreviewElement!: HTMLElement|null;\n  private dummyElement!: HTMLElement|null;\n  fontStyleElement!: HTMLStyleElement|null;\n  private inResize!: boolean|null;\n  constructor(mimeType: string, contentProvider: TextUtils.ContentProvider.ContentProvider) {\n    super(i18nString(UIStrings.font));\n    this.registerRequiredCSS(fontViewStyles);\n    this.element.classList.add('font-view');\n    this.element.setAttribute('jslog', `${VisualLogging.pane('font-view')}`);\n    this.url = contentProvider.contentURL();\n    UI.ARIAUtils.setLabel(this.element, i18nString(UIStrings.previewOfFontFromS, {PH1: this.url}));\n    this.contentProvider = contentProvider;\n    this.mimeTypeLabel = new UI.Toolbar.ToolbarText(mimeType);\n  }\n\n  override async toolbarItems(): Promise<UI.Toolbar.ToolbarItem[]> {\n    return [this.mimeTypeLabel];\n  }\n\n  private onFontContentLoaded(uniqueFontName: string, contentData: TextUtils.ContentData.ContentDataOrError): void {\n    const url = TextUtils.ContentData.ContentData.isError(contentData) ? this.url : contentData.asDataUrl();\n    if (!this.fontStyleElement) {\n      return;\n    }\n    this.fontStyleElement.textContent =\n        Platform.StringUtilities.sprintf('@font-face { font-family: \"%s\"; src: url(%s); }', uniqueFontName, url);\n    this.updateFontPreviewSize();\n  }\n\n  private createContentIfNeeded(): void {\n    if (this.fontPreviewElement) {\n      return;\n    }\n\n    const uniqueFontName = `WebInspectorFontPreview${++fontId}`;\n    this.fontStyleElement = document.createElement('style');\n    void this.contentProvider.requestContentData().then(contentData => {\n      this.onFontContentLoaded(uniqueFontName, contentData);\n    });\n    this.element.appendChild(this.fontStyleElement);\n\n    const fontPreview = document.createElement('div');\n    for (let i = 0; i < FONT_PREVIEW_LINES.length; ++i) {\n      if (i > 0) {\n        fontPreview.createChild('br');\n      }\n      UI.UIUtils.createTextChild(fontPreview, FONT_PREVIEW_LINES[i]);\n    }\n    this.fontPreviewElement = (fontPreview.cloneNode(true) as HTMLDivElement);\n    if (!this.fontPreviewElement) {\n      return;\n    }\n    UI.ARIAUtils.markAsHidden(this.fontPreviewElement);\n    this.fontPreviewElement.style.overflow = 'hidden';\n    this.fontPreviewElement.style.setProperty('font-family', uniqueFontName);\n    this.fontPreviewElement.style.setProperty('visibility', 'hidden');\n\n    this.dummyElement = fontPreview;\n    this.dummyElement.style.visibility = 'hidden';\n    this.dummyElement.style.zIndex = '-1';\n    this.dummyElement.style.display = 'inline';\n    this.dummyElement.style.position = 'absolute';\n    this.dummyElement.style.setProperty('font-family', uniqueFontName);\n    this.dummyElement.style.setProperty('font-size', MEASUURE_FONT_SIZE + 'px');\n\n    this.element.appendChild(this.fontPreviewElement);\n  }\n\n  override wasShown(): void {\n    this.createContentIfNeeded();\n\n    this.updateFontPreviewSize();\n  }\n\n  override onResize(): void {\n    if (this.inResize) {\n      return;\n    }\n\n    this.inResize = true;\n    try {\n      this.updateFontPreviewSize();\n    } finally {\n      this.inResize = null;\n    }\n  }\n\n  private measureElement(): {\n    width: number,\n    height: number,\n  } {\n    if (!this.dummyElement) {\n      throw new Error('No font preview loaded');\n    }\n    this.element.appendChild(this.dummyElement);\n    const result = {width: this.dummyElement.offsetWidth, height: this.dummyElement.offsetHeight};\n    this.element.removeChild(this.dummyElement);\n\n    return result;\n  }\n\n  updateFontPreviewSize(): void {\n    if (!this.fontPreviewElement || !this.isShowing()) {\n      return;\n    }\n\n    this.fontPreviewElement.style.removeProperty('visibility');\n    const dimension = this.measureElement();\n\n    const height = dimension.height;\n    const width = dimension.width;\n\n    // Subtract some padding. This should match the paddings in the CSS plus room for the scrollbar.\n    const containerWidth = this.element.offsetWidth - 50;\n    const containerHeight = this.element.offsetHeight - 30;\n\n    if (!height || !width || !containerWidth || !containerHeight) {\n      this.fontPreviewElement.style.removeProperty('font-size');\n      return;\n    }\n\n    const widthRatio = containerWidth / width;\n    const heightRatio = containerHeight / height;\n    const finalFontSize = Math.floor(MEASUURE_FONT_SIZE * Math.min(widthRatio, heightRatio)) - 2;\n\n    this.fontPreviewElement.style.setProperty('font-size', finalFontSize + 'px', undefined);\n  }\n}\n\nlet fontId = 0;\nconst FONT_PREVIEW_LINES = ['ABCDEFGHIJKLM', 'NOPQRSTUVWXYZ', 'abcdefghijklm', 'nopqrstuvwxyz', '1234567890'];\nconst MEASUURE_FONT_SIZE = 50;\n"],
  "mappings": "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",
  "names": []
}
