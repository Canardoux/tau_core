{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/ui/legacy/XWidget.ts"],
  "sourcesContent": ["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {XElement} from './XElement.js';\n\nlet observer: ResizeObserver|null = null;\n\nconst storedScrollPositions = new WeakMap<Element, {\n  scrollLeft: number,\n  scrollTop: number,\n}>();\n\nexport class XWidget extends XElement {\n  private visible: boolean;\n  private readonly shadowRootInternal!: DocumentFragment|null;\n  private defaultFocusedElement: Element|null;\n  private elementsToRestoreScrollPositionsFor: Element[];\n  private onShownCallback!: (() => void)|null;\n  private onHiddenCallback!: (() => void)|null;\n  private onResizedCallback!: (() => void)|null;\n\n  constructor() {\n    super();\n    this.style.setProperty('display', 'flex');\n    this.style.setProperty('flex-direction', 'column');\n    this.style.setProperty('align-items', 'stretch');\n    this.style.setProperty('justify-content', 'flex-start');\n    this.style.setProperty('contain', 'layout style');\n\n    this.visible = false;\n    this.defaultFocusedElement = null;\n    this.elementsToRestoreScrollPositionsFor = [];\n\n    if (!observer) {\n      observer = new ResizeObserver(entries => {\n        for (const entry of entries) {\n          const widget = (entry.target as XWidget);\n          if (widget.visible && widget.onResizedCallback) {\n            widget.onResizedCallback.call(null);\n          }\n        }\n      });\n    }\n\n    observer.observe(this);\n\n    this.setElementsToRestoreScrollPositionsFor([this]);\n  }\n\n  isShowing(): boolean {\n    return this.visible;\n  }\n\n  setOnShown(callback: (() => void)|null): void {\n    this.onShownCallback = callback;\n  }\n\n  setOnHidden(callback: (() => void)|null): void {\n    this.onHiddenCallback = callback;\n  }\n\n  setOnResized(callback: (() => void)|null): void {\n    this.onResizedCallback = callback;\n  }\n\n  setElementsToRestoreScrollPositionsFor(elements: Element[]): void {\n    for (const element of this.elementsToRestoreScrollPositionsFor) {\n      element.removeEventListener('scroll', XWidget.storeScrollPosition, {capture: false});\n    }\n    this.elementsToRestoreScrollPositionsFor = elements;\n    for (const element of this.elementsToRestoreScrollPositionsFor) {\n      element.addEventListener('scroll', XWidget.storeScrollPosition, {passive: true, capture: false});\n    }\n  }\n\n  restoreScrollPositions(): void {\n    for (const element of this.elementsToRestoreScrollPositionsFor) {\n      const storedPositions = storedScrollPositions.get(element);\n      if (storedPositions) {\n        element.scrollTop = storedPositions.scrollTop;\n        element.scrollLeft = storedPositions.scrollLeft;\n      }\n    }\n  }\n\n  private static storeScrollPosition(event: Event): void {\n    const element = (event.currentTarget as Element);\n    storedScrollPositions.set(element, {scrollLeft: element.scrollLeft, scrollTop: element.scrollTop});\n  }\n\n  setDefaultFocusedElement(element: Element|null): void {\n    if (element && !this.isSelfOrAncestor(element)) {\n      throw new Error('Default focus must be descendant');\n    }\n    this.defaultFocusedElement = element;\n  }\n\n  override focus(): void {\n    if (!this.visible) {\n      return;\n    }\n\n    let element;\n    if (this.defaultFocusedElement && this.isSelfOrAncestor(this.defaultFocusedElement)) {\n      element = this.defaultFocusedElement;\n    } else if (this.tabIndex !== -1) {\n      element = this;\n    } else {\n      let child = this.traverseNextNode(this);\n      while (child) {\n        if ((child instanceof XWidget) && child.visible) {\n          element = child;\n          break;\n        }\n        child = child.traverseNextNode(this);\n      }\n    }\n\n    if (!element || element.hasFocus()) {\n      return;\n    }\n    if (element === this) {\n      HTMLElement.prototype.focus.call(this);\n    } else {\n      (element as HTMLElement).focus();\n    }\n  }\n\n  connectedCallback(): void {\n    this.visible = true;\n    this.restoreScrollPositions();\n    if (this.onShownCallback) {\n      this.onShownCallback.call(null);\n    }\n  }\n\n  disconnectedCallback(): void {\n    this.visible = false;\n    if (this.onHiddenCallback) {\n      this.onHiddenCallback.call(null);\n    }\n  }\n}\n\ncustomElements.define('x-widget', XWidget);\n"],
  "mappings": "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",
  "names": []
}
