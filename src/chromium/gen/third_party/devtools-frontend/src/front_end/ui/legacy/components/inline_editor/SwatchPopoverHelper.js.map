{
  "version": 3,
  "sources": ["../../../../../../../../../../../third_party/devtools-frontend/src/front_end/ui/legacy/components/inline_editor/SwatchPopoverHelper.ts"],
  "sourcesContent": ["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as VisualLogging from '../../../visual_logging/visual_logging.js';\nimport * as UI from '../../legacy.js';\n\nimport {ColorSwatch} from './ColorSwatch.js';\nimport swatchPopoverStyles from './swatchPopover.css.js';\n\nexport class SwatchPopoverHelper extends Common.ObjectWrapper.ObjectWrapper<EventTypes> {\n  private readonly popover: UI.GlassPane.GlassPane;\n  private readonly hideProxy: () => void;\n  private readonly boundOnKeyDown: (event: KeyboardEvent) => void;\n  private readonly boundFocusOut: (event: FocusEvent) => void;\n  private isHidden: boolean;\n  private anchorElement: Element|null;\n  private view?: UI.Widget.Widget;\n  private hiddenCallback?: ((arg0: boolean) => void);\n  private focusRestorer?: UI.Widget.WidgetFocusRestorer;\n\n  constructor() {\n    super();\n    this.popover = new UI.GlassPane.GlassPane();\n    this.popover.setSizeBehavior(UI.GlassPane.SizeBehavior.MEASURE_CONTENT);\n    this.popover.setMarginBehavior(UI.GlassPane.MarginBehavior.ARROW);\n    this.popover.element.addEventListener('mousedown', e => e.consume(), false);\n\n    this.hideProxy = this.hide.bind(this, true);\n    this.boundOnKeyDown = this.onKeyDown.bind(this);\n    this.boundFocusOut = this.onFocusOut.bind(this);\n    this.isHidden = true;\n    this.anchorElement = null;\n  }\n\n  private onFocusOut(event: FocusEvent): void {\n    const relatedTarget = (event.relatedTarget as Element | null);\n    if (this.isHidden || !relatedTarget || !this.view || relatedTarget.isSelfOrDescendant(this.view.contentElement)) {\n      return;\n    }\n    this.hideProxy();\n  }\n\n  setAnchorElement(anchorElement: Element): void {\n    this.anchorElement = anchorElement;\n  }\n\n  isShowing(view?: UI.Widget.Widget): boolean {\n    return this.popover.isShowing() && ((view && this.view === view) || !view);\n  }\n\n  show(view: UI.Widget.Widget, anchorElement: Element, hiddenCallback?: ((arg0: boolean) => void)): void {\n    if (this.popover.isShowing()) {\n      if (this.anchorElement === anchorElement) {\n        return;\n      }\n\n      // Reopen the picker for another anchor element.\n      this.hide(true);\n    }\n\n    VisualLogging.setMappedParent(view.contentElement, anchorElement);\n    this.popover.registerCSSFiles([swatchPopoverStyles]);\n    this.dispatchEventToListeners(Events.WILL_SHOW_POPOVER);\n\n    this.isHidden = false;\n    this.anchorElement = anchorElement;\n    this.view = view;\n    this.hiddenCallback = hiddenCallback;\n    this.reposition();\n    view.focus();\n\n    const document = this.popover.element.ownerDocument;\n    document.addEventListener('mousedown', this.hideProxy, false);\n    if (document.defaultView) {\n      document.defaultView.addEventListener('resize', this.hideProxy, false);\n    }\n    this.view.contentElement.addEventListener('keydown', this.boundOnKeyDown, false);\n  }\n\n  reposition(): void {\n    // This protects against trying to reposition the popover after it has been hidden.\n    if (this.isHidden || !this.view) {\n      return;\n    }\n    // Unbind \"blur\" listener to avoid reenterability: |popover.show()| will hide the popover and trigger it synchronously.\n    this.view.contentElement.removeEventListener('focusout', this.boundFocusOut, false);\n    this.view.show(this.popover.contentElement);\n    if (this.anchorElement) {\n      let anchorBox = this.anchorElement.boxInWindow();\n      if (ColorSwatch.isColorSwatch(this.anchorElement)) {\n        const swatch = (this.anchorElement as ColorSwatch);\n        if (!swatch.anchorBox) {\n          return;\n        }\n        anchorBox = swatch.anchorBox;\n      }\n\n      this.popover.setContentAnchorBox(anchorBox);\n      this.popover.show((this.anchorElement.ownerDocument as Document));\n    }\n    this.view.contentElement.addEventListener('focusout', this.boundFocusOut, false);\n    if (!this.focusRestorer) {\n      this.focusRestorer = new UI.Widget.WidgetFocusRestorer(this.view);\n    }\n  }\n\n  hide(commitEdit?: boolean): void {\n    if (this.isHidden) {\n      return;\n    }\n    const document = this.popover.element.ownerDocument;\n    this.isHidden = true;\n    this.popover.hide();\n\n    document.removeEventListener('mousedown', this.hideProxy, false);\n    if (document.defaultView) {\n      document.defaultView.removeEventListener('resize', this.hideProxy, false);\n    }\n\n    if (this.hiddenCallback) {\n      this.hiddenCallback.call(null, Boolean(commitEdit));\n    }\n\n    if (this.focusRestorer) {\n      this.focusRestorer.restore();\n    }\n    this.anchorElement = null;\n    if (this.view) {\n      this.view.detach();\n      this.view.contentElement.removeEventListener('keydown', this.boundOnKeyDown, false);\n      this.view.contentElement.removeEventListener('focusout', this.boundFocusOut, false);\n      delete this.view;\n    }\n  }\n\n  private onKeyDown(event: KeyboardEvent): void {\n    if (event.key === 'Enter') {\n      this.hide(true);\n      event.consume(true);\n      return;\n    }\n    if (event.key === Platform.KeyboardUtilities.ESCAPE_KEY) {\n      this.hide(false);\n      event.consume(true);\n    }\n  }\n}\n\nexport const enum Events {\n  WILL_SHOW_POPOVER = 'WillShowPopover',\n}\n\nexport type EventTypes = {\n  [Events.WILL_SHOW_POPOVER]: void,\n};\n"],
  "mappings": "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",
  "names": ["Events"]
}
