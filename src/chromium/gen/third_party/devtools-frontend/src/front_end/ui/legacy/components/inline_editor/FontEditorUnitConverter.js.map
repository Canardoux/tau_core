{
  "version": 3,
  "sources": ["../../../../../../../../../../../third_party/devtools-frontend/src/front_end/ui/legacy/components/inline_editor/FontEditorUnitConverter.ts"],
  "sourcesContent": ["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport * as CssOverviewModule from '../../../../panels/css_overview/css_overview.js';\nimport * as UI from '../../legacy.js';\n\nconst computedArrayFontSizeIndex = 6;\n\nfunction getPxMultiplier(): number {\n  return 1;\n}\nasync function getEmMultiplier(isFontSizeProperty?: boolean): Promise<number> {\n  const selectedNode = UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode);\n  let currentFontSize;\n  if (selectedNode && selectedNode.parentNode && selectedNode.nodeName() !== 'HTML') {\n    const [model] =\n        SDK.TargetManager.TargetManager.instance().models(CssOverviewModule.CSSOverviewModel.CSSOverviewModel);\n    const fontSizeNodeId = isFontSizeProperty ? selectedNode.parentNode.id : selectedNode.id;\n    const computedFontSize = await model.getComputedStyleForNode(fontSizeNodeId).then(findFontSizeValue);\n    const computedFontSizeValue = computedFontSize.replace(/[a-z]/g, '');\n    currentFontSize = parseFloat(computedFontSizeValue);\n  } else {\n    currentFontSize = 16;\n  }\n  return currentFontSize;\n}\n\nasync function getRemMultiplier(): Promise<number> {\n  const selectedNode = UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode);\n  const htmlNode = findHtmlNode(selectedNode);\n  if (!htmlNode || !htmlNode.id) {\n    return 16;\n  }\n  const [model] =\n      SDK.TargetManager.TargetManager.instance().models(CssOverviewModule.CSSOverviewModel.CSSOverviewModel);\n  const computedRootFontSize = await model.getComputedStyleForNode(htmlNode.id).then(findFontSizeValue);\n  const rootFontSizeValue = computedRootFontSize.replace(/[a-z]/g, '');\n  const rootFontSize = parseFloat(rootFontSizeValue);\n  return rootFontSize;\n}\n\nasync function getPercentMultiplier(isFontSizeProperty?: boolean): Promise<number> {\n  const emMultiplier = await getEmMultiplier(isFontSizeProperty);\n  const percMultiplier = emMultiplier / 100;\n  return percMultiplier;\n}\n\nasync function getVhMultiplier(): Promise<number> {\n  const viewportObject = await getViewportObject();\n  if (!viewportObject) {\n    return 1;\n  }\n  const viewportHeight = viewportObject.height;\n  const vhMultiplier = viewportHeight / 100;\n  return vhMultiplier;\n}\n\nasync function getVwMultiplier(): Promise<number> {\n  const viewportObject = await getViewportObject();\n  if (!viewportObject) {\n    return 1;\n  }\n  const viewportWidth = viewportObject.width;\n  const vwMultiplier = viewportWidth / 100;\n  return vwMultiplier;\n}\n\nasync function getVminMultiplier(): Promise<number> {\n  const viewportObject = await getViewportObject();\n  if (!viewportObject) {\n    return 1;\n  }\n  const viewportWidth = viewportObject.width;\n  const viewportHeight = viewportObject.height;\n  const minViewportSize = Math.min(viewportWidth, viewportHeight);\n  const vminMultiplier = minViewportSize / 100;\n  return vminMultiplier;\n}\n\nasync function getVmaxMultiplier(): Promise<number> {\n  const viewportObject = await getViewportObject();\n  if (!viewportObject) {\n    return 1;\n  }\n  const viewportWidth = viewportObject.width;\n  const viewportHeight = viewportObject.height;\n  const maxViewportSize = Math.max(viewportWidth, viewportHeight);\n  const vmaxMultiplier = maxViewportSize / 100;\n  return vmaxMultiplier;\n}\n\nfunction getCmMultiplier(): number {\n  return 37.795;\n}\n\nfunction getMmMultiplier(): number {\n  return 3.7795;\n}\n\nfunction getInMultiplier(): number {\n  return 96;\n}\n\nfunction getPtMultiplier(): number {\n  return 4 / 3;\n}\n\nfunction getPcMultiplier(): number {\n  return 16;\n}\n\nfunction findFontSizeValue(computedObject: {\n  computedStyle: Array<{\n    name: string,\n    value: string,\n  }>,\n  getError: () => void,\n}): string {\n  const computedArray: {\n    name: string,\n    value: string,\n  }[] = computedObject.computedStyle;\n  let index = computedArrayFontSizeIndex;\n  if (computedArray[index].name && computedArray[index].name !== 'font-size') {\n    for (let i = 0; i < computedArray.length; i++) {\n      if (computedArray[i].name === 'font-size') {\n        index = i;\n        break;\n      }\n    }\n  }\n  return computedArray[index].value;\n}\n\nfunction findHtmlNode(selectedNode: SDK.DOMModel.DOMNode|null): SDK.DOMModel.DOMNode|null {\n  let node: SDK.DOMModel.DOMNode|(SDK.DOMModel.DOMNode | null) = selectedNode;\n  while (node && node.nodeName() !== 'HTML') {\n    if (node.parentNode) {\n      node = node.parentNode;\n    } else {\n      break;\n    }\n  }\n  return node;\n}\n\nconst widthEvaluateParams = {\n  expression: 'window.innerWidth',\n  includeCommandLineAPI: false,\n  silent: true,\n  returnByValue: false,\n  generatePreview: false,\n  userGesture: false,\n  awaitPromise: true,\n  throwOnSideEffect: false,\n  disableBreaks: true,\n  replMode: false,\n  allowUnsafeEvalBlockedByCSP: false,\n};\n\nconst heightEvaluateParams = {\n  expression: 'window.innerHeight',\n  includeCommandLineAPI: false,\n  silent: true,\n  returnByValue: false,\n  generatePreview: false,\n  userGesture: false,\n  awaitPromise: true,\n  throwOnSideEffect: false,\n  disableBreaks: true,\n  replMode: false,\n  allowUnsafeEvalBlockedByCSP: false,\n};\n\nasync function getViewportObject(): Promise<{\n  width: number,\n  height: number,\n}|null> {\n  const currentExecutionContext = UI.Context.Context.instance().flavor(SDK.RuntimeModel.ExecutionContext);\n  let width, height;\n  if (currentExecutionContext) {\n    const widthObject = await currentExecutionContext.evaluate(widthEvaluateParams, false, false);\n    const heightObject = await currentExecutionContext.evaluate(heightEvaluateParams, false, false);\n    if ('error' in widthObject || 'error' in heightObject) {\n      return null;\n    }\n    if (widthObject.object) {\n      width = widthObject.object.value;\n    }\n    if (heightObject.object) {\n      height = heightObject.object.value;\n    }\n  }\n  if (width === undefined || height === undefined) {\n    const selectedNode = UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode);\n    if (!selectedNode) {\n      return null;\n    }\n    const pageLayout = await selectedNode.domModel().target().pageAgent().invoke_getLayoutMetrics();\n    const zoom = pageLayout.visualViewport.zoom ? pageLayout.visualViewport.zoom : 1;\n    height = pageLayout.visualViewport.clientHeight / zoom;\n    width = pageLayout.visualViewport.clientWidth / zoom;\n  }\n  return {width, height};\n}\n\nconst unitConversionMap = new Map<string, (isFontSize?: boolean) => number | Promise<number>>();\nunitConversionMap.set('px', getPxMultiplier);\nunitConversionMap.set('em', getEmMultiplier);\nunitConversionMap.set('rem', getRemMultiplier);\nunitConversionMap.set('%', getPercentMultiplier);\nunitConversionMap.set('vh', getVhMultiplier);\nunitConversionMap.set('vw', getVwMultiplier);\nunitConversionMap.set('vmin', getVminMultiplier);\nunitConversionMap.set('vmax', getVmaxMultiplier);\nunitConversionMap.set('cm', getCmMultiplier);\nunitConversionMap.set('mm', getMmMultiplier);\nunitConversionMap.set('in', getInMultiplier);\nunitConversionMap.set('pt', getPtMultiplier);\nunitConversionMap.set('pc', getPcMultiplier);\n\nexport async function getUnitConversionMultiplier(\n    prevUnit: string, newUnit: string, isFontSize?: boolean): Promise<number> {\n  if (prevUnit === '') {\n    prevUnit = 'em';\n  }\n  if (newUnit === '') {\n    newUnit = 'em';\n  }\n  let prevUnitMultiplier, newUnitMultiplier;\n  const prevUnitFunction = unitConversionMap.get(prevUnit);\n  const newUnitFunction = unitConversionMap.get(newUnit);\n  if (prevUnitFunction && newUnitFunction) {\n    if (prevUnit === 'em' || prevUnit === '%') {\n      prevUnitMultiplier = await prevUnitFunction(isFontSize);\n    } else {\n      prevUnitMultiplier = await prevUnitFunction();\n    }\n    if (newUnit === 'em' || newUnit === '%') {\n      newUnitMultiplier = await newUnitFunction(isFontSize);\n    } else {\n      newUnitMultiplier = await newUnitFunction();\n    }\n  } else {\n    return 1;\n  }\n  return prevUnitMultiplier / newUnitMultiplier;\n}\n"],
  "mappings": "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",
  "names": []
}
