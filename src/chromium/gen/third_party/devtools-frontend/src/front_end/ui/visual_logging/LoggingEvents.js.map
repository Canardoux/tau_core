{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/ui/visual_logging/LoggingEvents.ts"],
  "sourcesContent": ["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport {assertNotNullOrUndefined} from '../../core/platform/platform.js';\n\nimport {processEventForDebugging, processImpressionsForDebugging} from './Debugging.js';\nimport type {Loggable} from './Loggable.js';\nimport {getLoggingState, type LoggingState} from './LoggingState.js';\n\nexport async function logImpressions(loggables: Loggable[]): Promise<void> {\n  const impressions = await Promise.all(loggables.map(async loggable => {\n    const loggingState = getLoggingState(loggable);\n    assertNotNullOrUndefined(loggingState);\n    const impression:\n        Host.InspectorFrontendHostAPI.VisualElementImpression = {id: loggingState.veid, type: loggingState.config.ve};\n    if (typeof loggingState.config.context !== 'undefined') {\n      impression.context = await contextAsNumber(loggingState.config.context);\n    }\n    if (loggingState.parent) {\n      impression.parent = loggingState.parent.veid;\n    }\n    if (loggingState.size) {\n      impression.width = Math.round(loggingState.size.width);\n      impression.height = Math.round(loggingState.size.height);\n    }\n    return impression;\n  }));\n  if (impressions.length) {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordImpression({impressions});\n    processImpressionsForDebugging(loggables.map(l => getLoggingState(l) as LoggingState));\n  }\n}\n\nexport const logResize = (loggable: Loggable, size: DOMRect): void => {\n  const loggingState = getLoggingState(loggable);\n  if (!loggingState) {\n    return;\n  }\n  loggingState.size = size;\n  const resizeEvent: Host.InspectorFrontendHostAPI\n      .ResizeEvent = {veid: loggingState.veid, width: loggingState.size.width, height: loggingState.size.height};\n  Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordResize(resizeEvent);\n  processEventForDebugging('Resize', loggingState, {width: Math.round(size.width), height: Math.round(size.height)});\n};\n\nexport const logClick = (throttler: Common.Throttler.Throttler) => (\n    loggable: Loggable, event: Event, options?: {doubleClick?: boolean}) => {\n  const loggingState = getLoggingState(loggable);\n  if (!loggingState) {\n    return;\n  }\n  const clickEvent:\n      Host.InspectorFrontendHostAPI.ClickEvent = {veid: loggingState.veid, doubleClick: Boolean(options?.doubleClick)};\n  if (event instanceof MouseEvent && 'sourceCapabilities' in event && event.sourceCapabilities) {\n    clickEvent.mouseButton = event.button;\n  }\n  void throttler.schedule(async () => {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordClick(clickEvent);\n    processEventForDebugging(\n        'Click', loggingState, {mouseButton: clickEvent.mouseButton, doubleClick: clickEvent.doubleClick});\n  });\n};\n\nexport const logHover = (throttler: Common.Throttler.Throttler) => async (event: Event) => {\n  const loggingState = getLoggingState(event.currentTarget as Element);\n  assertNotNullOrUndefined(loggingState);\n  const hoverEvent: Host.InspectorFrontendHostAPI.HoverEvent = {veid: loggingState.veid};\n  void throttler.schedule(async () => {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordHover(hoverEvent);\n    processEventForDebugging('Hover', loggingState);\n  }, Common.Throttler.Scheduling.DELAYED);\n};\n\nexport const logDrag = (throttler: Common.Throttler.Throttler) => async (event: Event) => {\n  const loggingState = getLoggingState(event.currentTarget as Element);\n  assertNotNullOrUndefined(loggingState);\n  const dragEvent: Host.InspectorFrontendHostAPI.DragEvent = {veid: loggingState.veid};\n  void throttler.schedule(async () => {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordDrag(dragEvent);\n    processEventForDebugging('Drag', loggingState);\n  }, Common.Throttler.Scheduling.DELAYED);\n};\n\nexport async function logChange(loggable: Loggable): Promise<void> {\n  const loggingState = getLoggingState(loggable);\n  assertNotNullOrUndefined(loggingState);\n  const changeEvent: Host.InspectorFrontendHostAPI.ChangeEvent = {veid: loggingState.veid};\n  const context = loggingState.pendingChangeContext;\n  if (context) {\n    changeEvent.context = await contextAsNumber(context);\n  }\n  Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordChange(changeEvent);\n  processEventForDebugging('Change', loggingState, {context});\n}\n\nlet pendingKeyDownContext: string|null = null;\n\nexport const logKeyDown = (throttler: Common.Throttler.Throttler) =>\n    async (loggable: Loggable|null, event: Event|null, context?: string) => {\n  if (!(event instanceof KeyboardEvent)) {\n    return;\n  }\n  const loggingState = loggable ? getLoggingState(loggable) : null;\n  const codes = (typeof loggingState?.config.track?.keydown === 'string') ? loggingState.config.track.keydown : '';\n  if (codes.length && !codes.split('|').includes(event.code) && !codes.split('|').includes(event.key)) {\n    return;\n  }\n  const keyDownEvent: Host.InspectorFrontendHostAPI.KeyDownEvent = {veid: loggingState?.veid};\n  if (!context && codes?.length) {\n    context = contextFromKeyCodes(event);\n  }\n\n  if (pendingKeyDownContext && context && pendingKeyDownContext !== context) {\n    void throttler.process?.();\n  }\n\n  pendingKeyDownContext = context || null;\n  void throttler.schedule(async () => {\n    if (context) {\n      keyDownEvent.context = await contextAsNumber(context);\n    }\n\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordKeyDown(keyDownEvent);\n    processEventForDebugging('KeyDown', loggingState, {context});\n    pendingKeyDownContext = null;\n  });\n};\n\nfunction contextFromKeyCodes(event: Event): string|undefined {\n  if (!(event instanceof KeyboardEvent)) {\n    return undefined;\n  }\n  const key = event.key;\n  const lowerCaseKey = key.toLowerCase();\n  const components = [];\n  if (event.shiftKey && key !== lowerCaseKey) {\n    components.push('shift');\n  }\n  if (event.ctrlKey) {\n    components.push('ctrl');\n  }\n  if (event.altKey) {\n    components.push('alt');\n  }\n  if (event.metaKey) {\n    components.push('meta');\n  }\n  components.push(lowerCaseKey);\n  return components.join('-');\n}\n\nasync function contextAsNumber(context: string|undefined): Promise<number|undefined> {\n  if (typeof context === 'undefined') {\n    return undefined;\n  }\n  const number = parseInt(context, 10);\n  if (!isNaN(number)) {\n    return number;\n  }\n  if (!crypto.subtle) {\n    // Layout tests run in an insecure context where crypto.subtle is not available.\n    return 0xDEADBEEF;\n  }\n  const encoder = new TextEncoder();\n  const data = encoder.encode(context);\n  const digest = await crypto.subtle.digest('SHA-1', data);\n  return new DataView(digest).getInt32(0, true);\n}\n"],
  "mappings": "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",
  "names": []
}
