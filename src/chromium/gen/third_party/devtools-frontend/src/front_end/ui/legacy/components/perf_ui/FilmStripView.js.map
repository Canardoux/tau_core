{
  "version": 3,
  "sources": ["../../../../../../../../../../../third_party/devtools-frontend/src/front_end/ui/legacy/components/perf_ui/FilmStripView.ts"],
  "sourcesContent": ["// Copyright 2015 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as Host from '../../../../core/host/host.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as Trace from '../../../../models/trace/trace.js';\nimport * as VisualLogging from '../../../visual_logging/visual_logging.js';\nimport * as UI from '../../legacy.js';\n\nimport filmStripViewStyles from './filmStripView.css.legacy.js';\n\nconst UIStrings = {\n  /**\n   *@description Element title in Film Strip View of the Performance panel\n   */\n  doubleclickToZoomImageClickTo: 'Doubleclick to zoom image. Click to view preceding requests.',\n  /**\n   *@description Aria label for captured screenshots in network panel.\n   *@example {3ms} PH1\n   */\n  screenshotForSSelectToView: 'Screenshot for {PH1} - select to view preceding requests.',\n  /**\n   *@description Text for one or a group of screenshots\n   */\n  screenshot: 'Screenshot',\n  /**\n   *@description Prev button title in Film Strip View of the Performance panel\n   */\n  previousFrame: 'Previous frame',\n  /**\n   *@description Next button title in Film Strip View of the Performance panel\n   */\n  nextFrame: 'Next frame',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/perf_ui/FilmStripView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class FilmStripView extends Common.ObjectWrapper.eventMixin<EventTypes, typeof UI.Widget.HBox>(UI.Widget.HBox) {\n  private statusLabel: HTMLElement;\n  private zeroTime: Trace.Types.Timing.MilliSeconds = Trace.Types.Timing.MilliSeconds(0);\n  #filmStrip: Trace.Extras.FilmStrip.Data|null = null;\n\n  constructor() {\n    super(true);\n    this.registerRequiredCSS(filmStripViewStyles);\n    this.contentElement.classList.add('film-strip-view');\n    this.statusLabel = this.contentElement.createChild('div', 'label');\n    this.reset();\n  }\n\n  static setImageData(imageElement: HTMLImageElement, dataUri: string|null): void {\n    if (dataUri) {\n      imageElement.src = dataUri;\n    }\n  }\n\n  setModel(filmStrip: Trace.Extras.FilmStrip.Data): void {\n    this.#filmStrip = filmStrip;\n    this.zeroTime = Trace.Helpers.Timing.microSecondsToMilliseconds(filmStrip.zeroTime);\n\n    if (!this.#filmStrip.frames.length) {\n      this.reset();\n      return;\n    }\n    this.update();\n  }\n\n  createFrameElement(frame: Trace.Extras.FilmStrip.Frame): HTMLButtonElement {\n    const time = Trace.Helpers.Timing.microSecondsToMilliseconds(frame.screenshotEvent.ts);\n    const frameTime = i18n.TimeUtilities.millisToString(time - this.zeroTime);\n    const element = document.createElement('button');\n    element.classList.add('frame');\n    UI.Tooltip.Tooltip.install(element, i18nString(UIStrings.doubleclickToZoomImageClickTo));\n    element.createChild('div', 'time').textContent = frameTime;\n    element.tabIndex = 0;\n    element.setAttribute('jslog', `${VisualLogging.preview('film-strip').track({click: true, dblclick: true})}`);\n    element.setAttribute('aria-label', i18nString(UIStrings.screenshotForSSelectToView, {PH1: frameTime}));\n    UI.ARIAUtils.markAsButton(element);\n    const imageElement = (element.createChild('div', 'thumbnail').createChild('img') as HTMLImageElement);\n    imageElement.alt = i18nString(UIStrings.screenshot);\n    element.addEventListener('mousedown', this.onMouseEvent.bind(this, Events.FRAME_SELECTED, time), false);\n    element.addEventListener('mouseenter', this.onMouseEvent.bind(this, Events.FRAME_ENTER, time), false);\n    element.addEventListener('mouseout', this.onMouseEvent.bind(this, Events.FRAME_EXIT, time), false);\n    element.addEventListener('dblclick', this.onDoubleClick.bind(this, frame), false);\n    element.addEventListener('focusin', this.onMouseEvent.bind(this, Events.FRAME_ENTER, time), false);\n    element.addEventListener('focusout', this.onMouseEvent.bind(this, Events.FRAME_EXIT, time), false);\n\n    FilmStripView.setImageData(imageElement, frame.screenshotEvent.args.dataUri);\n    return element;\n  }\n\n  override update(): void {\n    const frames = this.#filmStrip?.frames;\n    if (!frames || frames.length < 1) {\n      return;\n    }\n\n    const frameElements = frames.map(frame => this.createFrameElement(frame));\n    this.contentElement.removeChildren();\n    for (const element of frameElements) {\n      this.contentElement.appendChild(element);\n    }\n  }\n\n  private onMouseEvent(eventName: string|symbol, timestamp: number): void {\n    // TODO(crbug.com/1228674): Use type-safe event dispatch and remove <any>.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    this.dispatchEventToListeners<any>(eventName, timestamp);\n  }\n\n  private onDoubleClick(filmStripFrame: Trace.Extras.FilmStrip.Frame): void {\n    if (!this.#filmStrip) {\n      return;\n    }\n    Dialog.fromFilmStrip(this.#filmStrip, filmStripFrame.index);\n  }\n\n  reset(): void {\n    this.zeroTime = Trace.Types.Timing.MilliSeconds(0);\n    this.contentElement.removeChildren();\n    this.contentElement.appendChild(this.statusLabel);\n  }\n\n  setStatusText(text: string): void {\n    this.statusLabel.textContent = text;\n  }\n}\n\nexport const enum Events {\n  FRAME_SELECTED = 'FrameSelected',\n  FRAME_ENTER = 'FrameEnter',\n  FRAME_EXIT = 'FrameExit',\n}\n\nexport type EventTypes = {\n  [Events.FRAME_SELECTED]: number,\n  [Events.FRAME_ENTER]: number,\n  [Events.FRAME_EXIT]: number,\n};\n\ninterface DialogParsedTrace {\n  source: 'Trace';\n  index: number;\n  zeroTime: Trace.Types.Timing.MilliSeconds;\n  frames: readonly Trace.Extras.FilmStrip.Frame[];\n}\n\nexport class Dialog {\n  private fragment: UI.Fragment.Fragment;\n  private readonly widget: UI.XWidget.XWidget;\n  private index: number;\n  private dialog: UI.Dialog.Dialog|null = null;\n\n  #data: DialogParsedTrace;\n\n  static fromFilmStrip(filmStrip: Trace.Extras.FilmStrip.Data, selectedFrameIndex: number): Dialog {\n    const data: DialogParsedTrace = {\n      source: 'Trace',\n      frames: filmStrip.frames,\n      index: selectedFrameIndex,\n      zeroTime: Trace.Helpers.Timing.microSecondsToMilliseconds(filmStrip.zeroTime),\n    };\n    return new Dialog(data);\n  }\n\n  private constructor(data: DialogParsedTrace) {\n    this.#data = data;\n    this.index = data.index;\n    const prevButton = UI.UIUtils.createTextButton('\\u25C0', this.onPrevFrame.bind(this));\n    UI.Tooltip.Tooltip.install(prevButton, i18nString(UIStrings.previousFrame));\n    const nextButton = UI.UIUtils.createTextButton('\\u25B6', this.onNextFrame.bind(this));\n    UI.Tooltip.Tooltip.install(nextButton, i18nString(UIStrings.nextFrame));\n    this.fragment = UI.Fragment.Fragment.build`\n      <x-widget flex=none margin=12px>\n        <x-hbox overflow=auto border='1px solid #ddd'>\n          <img $='image' data-film-strip-dialog-img style=\"max-height: 80vh; max-width: 80vw;\"></img>\n        </x-hbox>\n        <x-hbox x-center justify-content=center margin-top=10px>\n          ${prevButton}\n          <x-hbox $='time' margin=8px></x-hbox>\n          ${nextButton}\n        </x-hbox>\n      </x-widget>\n    `;\n    this.widget = (this.fragment.element() as UI.XWidget.XWidget);\n    (this.widget as HTMLElement).tabIndex = 0;\n    this.widget.addEventListener('keydown', this.keyDown.bind(this), false);\n    this.dialog = null;\n\n    void this.render();\n  }\n\n  hide(): void {\n    if (this.dialog) {\n      this.dialog.hide();\n    }\n  }\n\n  #framesCount(): number {\n    return this.#data.frames.length;\n  }\n\n  #zeroTime(): Trace.Types.Timing.MilliSeconds {\n    return this.#data.zeroTime;\n  }\n\n  private resize(): void {\n    if (!this.dialog) {\n      this.dialog = new UI.Dialog.Dialog();\n      this.dialog.contentElement.appendChild(this.widget);\n      this.dialog.setDefaultFocusedElement(this.widget);\n      this.dialog.show();\n    }\n    this.dialog.setSizeBehavior(UI.GlassPane.SizeBehavior.MEASURE_CONTENT);\n  }\n\n  private keyDown(event: Event): void {\n    const keyboardEvent = (event as KeyboardEvent);\n    switch (keyboardEvent.key) {\n      case 'ArrowLeft':\n        if (Host.Platform.isMac() && keyboardEvent.metaKey) {\n          this.onFirstFrame();\n        } else {\n          this.onPrevFrame();\n        }\n        break;\n\n      case 'ArrowRight':\n        if (Host.Platform.isMac() && keyboardEvent.metaKey) {\n          this.onLastFrame();\n        } else {\n          this.onNextFrame();\n        }\n        break;\n\n      case 'Home':\n        this.onFirstFrame();\n        break;\n\n      case 'End':\n        this.onLastFrame();\n        break;\n    }\n  }\n\n  private onPrevFrame(): void {\n    if (this.index > 0) {\n      --this.index;\n    }\n    void this.render();\n  }\n\n  private onNextFrame(): void {\n    if (this.index < this.#framesCount() - 1) {\n      ++this.index;\n    }\n    void this.render();\n  }\n\n  private onFirstFrame(): void {\n    this.index = 0;\n    void this.render();\n  }\n\n  private onLastFrame(): void {\n    this.index = this.#framesCount() - 1;\n    void this.render();\n  }\n\n  private render(): void {\n    const frame = this.#data.frames[this.index];\n    const timestamp = Trace.Helpers.Timing.microSecondsToMilliseconds(frame.screenshotEvent.ts);\n    this.fragment.$('time').textContent = i18n.TimeUtilities.millisToString(timestamp - this.#zeroTime());\n    const image = (this.fragment.$('image') as HTMLImageElement);\n    image.setAttribute('data-frame-index', this.index.toString());\n    FilmStripView.setImageData(image, frame.screenshotEvent.args.dataUri);\n    this.resize();\n  }\n}\n"],
  "mappings": ";AAIA,YAAY,YAAY;AACxB,YAAY,UAAU;AACtB,YAAY,UAAU;AACtB,YAAY,WAAW;AACvB,YAAY,mBAAmB;AAC/B,YAAY,QAAQ;AAEpB,OAAO,yBAAyB;AAEhC,MAAM,YAAY;AAAA;AAAA;AAAA;AAAA,EAIhB,+BAA+B;AAAA;AAAA;AAAA;AAAA;AAAA,EAK/B,4BAA4B;AAAA;AAAA;AAAA;AAAA,EAI5B,YAAY;AAAA;AAAA;AAAA;AAAA,EAIZ,eAAe;AAAA;AAAA;AAAA;AAAA,EAIf,WAAW;AACb;AACA,MAAM,OAAO,KAAK,KAAK,kBAAkB,iDAAiD,SAAS;AACnG,MAAM,aAAa,KAAK,KAAK,mBAAmB,KAAK,QAAW,IAAI;AAC7D,aAAM,sBAAsB,OAAO,cAAc,WAA8C,GAAG,OAAO,IAAI,EAAE;AAAA,EAC5G;AAAA,EACA,WAA4C,MAAM,MAAM,OAAO,aAAa,CAAC;AAAA,EACrF,aAA+C;AAAA,EAE/C,cAAc;AACZ,UAAM,IAAI;AACV,SAAK,oBAAoB,mBAAmB;AAC5C,SAAK,eAAe,UAAU,IAAI,iBAAiB;AACnD,SAAK,cAAc,KAAK,eAAe,YAAY,OAAO,OAAO;AACjE,SAAK,MAAM;AAAA,EACb;AAAA,EAEA,OAAO,aAAa,cAAgC,SAA4B;AAC9E,QAAI,SAAS;AACX,mBAAa,MAAM;AAAA,IACrB;AAAA,EACF;AAAA,EAEA,SAAS,WAA8C;AACrD,SAAK,aAAa;AAClB,SAAK,WAAW,MAAM,QAAQ,OAAO,2BAA2B,UAAU,QAAQ;AAElF,QAAI,CAAC,KAAK,WAAW,OAAO,QAAQ;AAClC,WAAK,MAAM;AACX;AAAA,IACF;AACA,SAAK,OAAO;AAAA,EACd;AAAA,EAEA,mBAAmB,OAAwD;AACzE,UAAM,OAAO,MAAM,QAAQ,OAAO,2BAA2B,MAAM,gBAAgB,EAAE;AACrF,UAAM,YAAY,KAAK,cAAc,eAAe,OAAO,KAAK,QAAQ;AACxE,UAAM,UAAU,SAAS,cAAc,QAAQ;AAC/C,YAAQ,UAAU,IAAI,OAAO;AAC7B,OAAG,QAAQ,QAAQ,QAAQ,SAAS,WAAW,UAAU,6BAA6B,CAAC;AACvF,YAAQ,YAAY,OAAO,MAAM,EAAE,cAAc;AACjD,YAAQ,WAAW;AACnB,YAAQ,aAAa,SAAS,GAAG,cAAc,QAAQ,YAAY,EAAE,MAAM,EAAC,OAAO,MAAM,UAAU,KAAI,CAAC,CAAC,EAAE;AAC3G,YAAQ,aAAa,cAAc,WAAW,UAAU,4BAA4B,EAAC,KAAK,UAAS,CAAC,CAAC;AACrG,OAAG,UAAU,aAAa,OAAO;AACjC,UAAM,eAAgB,QAAQ,YAAY,OAAO,WAAW,EAAE,YAAY,KAAK;AAC/E,iBAAa,MAAM,WAAW,UAAU,UAAU;AAClD,YAAQ,iBAAiB,aAAa,KAAK,aAAa,KAAK,MAAM,sCAAuB,IAAI,GAAG,KAAK;AACtG,YAAQ,iBAAiB,cAAc,KAAK,aAAa,KAAK,MAAM,gCAAoB,IAAI,GAAG,KAAK;AACpG,YAAQ,iBAAiB,YAAY,KAAK,aAAa,KAAK,MAAM,8BAAmB,IAAI,GAAG,KAAK;AACjG,YAAQ,iBAAiB,YAAY,KAAK,cAAc,KAAK,MAAM,KAAK,GAAG,KAAK;AAChF,YAAQ,iBAAiB,WAAW,KAAK,aAAa,KAAK,MAAM,gCAAoB,IAAI,GAAG,KAAK;AACjG,YAAQ,iBAAiB,YAAY,KAAK,aAAa,KAAK,MAAM,8BAAmB,IAAI,GAAG,KAAK;AAEjG,kBAAc,aAAa,cAAc,MAAM,gBAAgB,KAAK,OAAO;AAC3E,WAAO;AAAA,EACT;AAAA,EAES,SAAe;AACtB,UAAM,SAAS,KAAK,YAAY;AAChC,QAAI,CAAC,UAAU,OAAO,SAAS,GAAG;AAChC;AAAA,IACF;AAEA,UAAM,gBAAgB,OAAO,IAAI,WAAS,KAAK,mBAAmB,KAAK,CAAC;AACxE,SAAK,eAAe,eAAe;AACnC,eAAW,WAAW,eAAe;AACnC,WAAK,eAAe,YAAY,OAAO;AAAA,IACzC;AAAA,EACF;AAAA,EAEQ,aAAa,WAA0B,WAAyB;AAGtE,SAAK,yBAA8B,WAAW,SAAS;AAAA,EACzD;AAAA,EAEQ,cAAc,gBAAoD;AACxE,QAAI,CAAC,KAAK,YAAY;AACpB;AAAA,IACF;AACA,WAAO,cAAc,KAAK,YAAY,eAAe,KAAK;AAAA,EAC5D;AAAA,EAEA,QAAc;AACZ,SAAK,WAAW,MAAM,MAAM,OAAO,aAAa,CAAC;AACjD,SAAK,eAAe,eAAe;AACnC,SAAK,eAAe,YAAY,KAAK,WAAW;AAAA,EAClD;AAAA,EAEA,cAAc,MAAoB;AAChC,SAAK,YAAY,cAAc;AAAA,EACjC;AACF;AAEO,WAAW,SAAX,kBAAWA,YAAX;AACL,EAAAA,QAAA,oBAAiB;AACjB,EAAAA,QAAA,iBAAc;AACd,EAAAA,QAAA,gBAAa;AAHG,SAAAA;AAAA,GAAA;AAmBX,aAAM,OAAO;AAAA,EACV;AAAA,EACS;AAAA,EACT;AAAA,EACA,SAAgC;AAAA,EAExC;AAAA,EAEA,OAAO,cAAc,WAAwC,oBAAoC;AAC/F,UAAM,OAA0B;AAAA,MAC9B,QAAQ;AAAA,MACR,QAAQ,UAAU;AAAA,MAClB,OAAO;AAAA,MACP,UAAU,MAAM,QAAQ,OAAO,2BAA2B,UAAU,QAAQ;AAAA,IAC9E;AACA,WAAO,IAAI,OAAO,IAAI;AAAA,EACxB;AAAA,EAEQ,YAAY,MAAyB;AAC3C,SAAK,QAAQ;AACb,SAAK,QAAQ,KAAK;AAClB,UAAM,aAAa,GAAG,QAAQ,iBAAiB,UAAU,KAAK,YAAY,KAAK,IAAI,CAAC;AACpF,OAAG,QAAQ,QAAQ,QAAQ,YAAY,WAAW,UAAU,aAAa,CAAC;AAC1E,UAAM,aAAa,GAAG,QAAQ,iBAAiB,UAAU,KAAK,YAAY,KAAK,IAAI,CAAC;AACpF,OAAG,QAAQ,QAAQ,QAAQ,YAAY,WAAW,UAAU,SAAS,CAAC;AACtE,SAAK,WAAW,GAAG,SAAS,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAM7B,UAAU;AAAA;AAAA,YAEV,UAAU;AAAA;AAAA;AAAA;AAIlB,SAAK,SAAU,KAAK,SAAS,QAAQ;AACrC,IAAC,KAAK,OAAuB,WAAW;AACxC,SAAK,OAAO,iBAAiB,WAAW,KAAK,QAAQ,KAAK,IAAI,GAAG,KAAK;AACtE,SAAK,SAAS;AAEd,SAAK,KAAK,OAAO;AAAA,EACnB;AAAA,EAEA,OAAa;AACX,QAAI,KAAK,QAAQ;AACf,WAAK,OAAO,KAAK;AAAA,IACnB;AAAA,EACF;AAAA,EAEA,eAAuB;AACrB,WAAO,KAAK,MAAM,OAAO;AAAA,EAC3B;AAAA,EAEA,YAA6C;AAC3C,WAAO,KAAK,MAAM;AAAA,EACpB;AAAA,EAEQ,SAAe;AACrB,QAAI,CAAC,KAAK,QAAQ;AAChB,WAAK,SAAS,IAAI,GAAG,OAAO,OAAO;AACnC,WAAK,OAAO,eAAe,YAAY,KAAK,MAAM;AAClD,WAAK,OAAO,yBAAyB,KAAK,MAAM;AAChD,WAAK,OAAO,KAAK;AAAA,IACnB;AACA,SAAK,OAAO,gBAAgB,GAAG,UAAU,aAAa,eAAe;AAAA,EACvE;AAAA,EAEQ,QAAQ,OAAoB;AAClC,UAAM,gBAAiB;AACvB,YAAQ,cAAc,KAAK;AAAA,MACzB,KAAK;AACH,YAAI,KAAK,SAAS,MAAM,KAAK,cAAc,SAAS;AAClD,eAAK,aAAa;AAAA,QACpB,OAAO;AACL,eAAK,YAAY;AAAA,QACnB;AACA;AAAA,MAEF,KAAK;AACH,YAAI,KAAK,SAAS,MAAM,KAAK,cAAc,SAAS;AAClD,eAAK,YAAY;AAAA,QACnB,OAAO;AACL,eAAK,YAAY;AAAA,QACnB;AACA;AAAA,MAEF,KAAK;AACH,aAAK,aAAa;AAClB;AAAA,MAEF,KAAK;AACH,aAAK,YAAY;AACjB;AAAA,IACJ;AAAA,EACF;AAAA,EAEQ,cAAoB;AAC1B,QAAI,KAAK,QAAQ,GAAG;AAClB,QAAE,KAAK;AAAA,IACT;AACA,SAAK,KAAK,OAAO;AAAA,EACnB;AAAA,EAEQ,cAAoB;AAC1B,QAAI,KAAK,QAAQ,KAAK,aAAa,IAAI,GAAG;AACxC,QAAE,KAAK;AAAA,IACT;AACA,SAAK,KAAK,OAAO;AAAA,EACnB;AAAA,EAEQ,eAAqB;AAC3B,SAAK,QAAQ;AACb,SAAK,KAAK,OAAO;AAAA,EACnB;AAAA,EAEQ,cAAoB;AAC1B,SAAK,QAAQ,KAAK,aAAa,IAAI;AACnC,SAAK,KAAK,OAAO;AAAA,EACnB;AAAA,EAEQ,SAAe;AACrB,UAAM,QAAQ,KAAK,MAAM,OAAO,KAAK,KAAK;AAC1C,UAAM,YAAY,MAAM,QAAQ,OAAO,2BAA2B,MAAM,gBAAgB,EAAE;AAC1F,SAAK,SAAS,EAAE,MAAM,EAAE,cAAc,KAAK,cAAc,eAAe,YAAY,KAAK,UAAU,CAAC;AACpG,UAAM,QAAS,KAAK,SAAS,EAAE,OAAO;AACtC,UAAM,aAAa,oBAAoB,KAAK,MAAM,SAAS,CAAC;AAC5D,kBAAc,aAAa,OAAO,MAAM,gBAAgB,KAAK,OAAO;AACpE,SAAK,OAAO;AAAA,EACd;AACF;",
  "names": ["Events"]
}
