{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/ui/legacy/Fragment.ts"],
  "sourcesContent": ["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nfunction getNodeData(node: Node): string {\n  return (node as unknown as {\n           data: string,\n         })\n      .data;\n}\n\nfunction setNodeData<T>(node: Node, value: T): void {\n  (node as unknown as {\n    data: T,\n  }).data = value;\n}\n\nexport class Fragment {\n  private readonly elementInternal: Element;\n  private readonly elementsById: Map<string, Element>;\n\n  constructor(element: Element) {\n    this.elementInternal = element;\n\n    this.elementsById = new Map();\n  }\n\n  element(): Element {\n    return this.elementInternal;\n  }\n\n  $(elementId: string): Element {\n    return this.elementsById.get(elementId) as Element;\n  }\n\n  static build(strings: TemplateDefinition, ...values: any[]): Fragment {\n    return Fragment.render(Fragment.template(strings), values);\n  }\n\n  static cached(strings: TemplateDefinition, ...values: any[]): Fragment {\n    let template = templateCache.get(strings);\n    if (!template) {\n      template = Fragment.template(strings);\n      templateCache.set(strings, template);\n    }\n    return Fragment.render(template, values);\n  }\n\n  private static template(strings: TemplateDefinition): Template {\n    let html = '';\n    let insideText = true;\n    for (let i = 0; i < strings.length - 1; i++) {\n      html += strings[i];\n      const close = strings[i].lastIndexOf('>');\n      const open = strings[i].indexOf('<', close + 1);\n      if (close !== -1 && open === -1) {\n        insideText = true;\n      } else if (open !== -1) {\n        insideText = false;\n      }\n      html += insideText ? textMarker : attributeMarker(i);\n    }\n    html += strings[strings.length - 1];\n\n    const template = document.createElement('template');\n    template.innerHTML = html;\n    const walker =\n        template.ownerDocument.createTreeWalker(template.content, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, null);\n    let valueIndex = 0;\n    const emptyTextNodes = [];\n    const binds: Bind[] = [];\n    const nodesToMark = [];\n    while (walker.nextNode()) {\n      const node = (walker.currentNode as HTMLElement);\n      if (node.nodeType === Node.ELEMENT_NODE && node.hasAttributes()) {\n        if (node.hasAttribute('$')) {\n          nodesToMark.push(node);\n          binds.push({replaceNodeIndex: undefined, attr: undefined, elementId: node.getAttribute('$') || ''});\n          node.removeAttribute('$');\n        }\n\n        const attributesToRemove = [];\n        for (let i = 0; i < node.attributes.length; i++) {\n          const name = node.attributes[i].name;\n\n          if (!attributeMarkerRegex.test(name) && !attributeMarkerRegex.test(node.attributes[i].value)) {\n            continue;\n          }\n\n          attributesToRemove.push(name);\n          nodesToMark.push(node);\n\n          const attr = {\n            index: valueIndex,\n            names: name.split(attributeMarkerRegex),\n            values: node.attributes[i].value.split(attributeMarkerRegex),\n          };\n          valueIndex += attr.names.length - 1;\n          valueIndex += attr.values.length - 1;\n          const bind: Bind = {\n            elementId: undefined,\n            replaceNodeIndex: undefined,\n            attr,\n          };\n          binds.push(bind);\n        }\n        for (let i = 0; i < attributesToRemove.length; i++) {\n          node.removeAttribute(attributesToRemove[i]);\n        }\n      }\n\n      if (node.nodeType === Node.TEXT_NODE && getNodeData(node).indexOf(textMarker) !== -1) {\n        const texts = getNodeData(node).split(textMarkerRegex);\n        setNodeData(node, texts[texts.length - 1]);\n        const parentNode = (node.parentNode as HTMLElement);\n        for (let i = 0; i < texts.length - 1; i++) {\n          if (texts[i]) {\n            parentNode.insertBefore(document.createTextNode(texts[i]), node);\n          }\n          const nodeToReplace = document.createElement('span');\n          nodesToMark.push(nodeToReplace);\n          binds.push({attr: undefined, elementId: undefined, replaceNodeIndex: valueIndex++});\n          parentNode.insertBefore(nodeToReplace, node);\n        }\n      }\n\n      if (node.nodeType === Node.TEXT_NODE &&\n          (!node.previousSibling || node.previousSibling.nodeType === Node.ELEMENT_NODE) &&\n          (!node.nextSibling || node.nextSibling.nodeType === Node.ELEMENT_NODE) && /^\\s*$/.test(getNodeData(node))) {\n        emptyTextNodes.push(node);\n      }\n    }\n\n    for (let i = 0; i < nodesToMark.length; i++) {\n      nodesToMark[i].classList.add(generateClassName(i));\n    }\n\n    for (const emptyTextNode of emptyTextNodes) {\n      emptyTextNode.remove();\n    }\n    return {template, binds};\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private static render(template: Template, values: any[]): Fragment {\n    const content = template.template.ownerDocument.importNode(template.template.content, true);\n    const resultElement = (content.firstChild === content.lastChild ? content.firstChild : content) as Element;\n    const result = new Fragment(resultElement);\n\n    const boundElements = [];\n    for (let i = 0; i < template.binds.length; i++) {\n      const className = generateClassName(i);\n      const element = (content.querySelector('.' + className) as Element);\n      element.classList.remove(className);\n      boundElements.push(element);\n    }\n\n    for (let bindIndex = 0; bindIndex < template.binds.length; bindIndex++) {\n      const bind = template.binds[bindIndex];\n      const element = boundElements[bindIndex];\n      if (bind.elementId !== undefined) {\n        result.elementsById.set(bind.elementId, element);\n      } else if (bind.replaceNodeIndex !== undefined) {\n        const value = values[bind.replaceNodeIndex];\n        (element.parentNode as HTMLElement).replaceChild(this.nodeForValue(value), element);\n      } else if (bind.attr !== undefined) {\n        if (bind.attr.names.length === 2 && bind.attr.values.length === 1 &&\n            typeof values[bind.attr.index] === 'function') {\n          values[bind.attr.index].call(null, element);\n        } else {\n          let name = bind.attr.names[0];\n          for (let i = 1; i < bind.attr.names.length; i++) {\n            name += values[bind.attr.index + i - 1];\n            name += bind.attr.names[i];\n          }\n          if (name) {\n            let value = bind.attr.values[0];\n            for (let i = 1; i < bind.attr.values.length; i++) {\n              value += values[bind.attr.index + bind.attr.names.length - 1 + i - 1];\n              value += bind.attr.values[i];\n            }\n            element.setAttribute(name, value);\n          }\n        }\n      } else {\n        throw new Error('Unexpected bind');\n      }\n    }\n    return result;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private static nodeForValue(value: any): Node {\n    if (value instanceof Node) {\n      return value;\n    }\n    if (value instanceof Fragment) {\n      return value.elementInternal;\n    }\n    if (Array.isArray(value)) {\n      const node = document.createDocumentFragment();\n      for (const v of value) {\n        node.appendChild(this.nodeForValue(v));\n      }\n      return node;\n    }\n    return document.createTextNode(String(value));\n  }\n}\n\nexport const textMarker = '{{template-text}}';\nconst textMarkerRegex = /{{template-text}}/;\nexport const attributeMarker = (index: number): string => 'template-attribute' + index;\nconst attributeMarkerRegex = /template-attribute\\d+/;\nconst generateClassName = (index: number): string => 'template-class-' + index;\nconst templateCache = new Map<TemplateDefinition, Template>();\n\nexport const html = (strings: TemplateDefinition, ...vararg: any[]): Element => {\n  return Fragment.cached(strings, ...vararg).element();\n};\n\nexport type TemplateDefinition = string[]|TemplateStringsArray;\n\nexport interface Bind {\n  elementId?: string;\n  attr?: {\n    index: number,\n    names: string[],\n    values: string[],\n  };\n  replaceNodeIndex?: number;\n}\n\nexport interface Template {\n  template: HTMLTemplateElement;\n  binds: Bind[];\n}\n"],
  "mappings": ";AAIA,SAAS,YAAY,MAAoB;AACvC,SAAQ,KAGH;AACP;AAEA,SAAS,YAAe,MAAY,OAAgB;AAClD,EAAC,KAEE,OAAO;AACZ;AAEO,aAAM,SAAS;AAAA,EACH;AAAA,EACA;AAAA,EAEjB,YAAY,SAAkB;AAC5B,SAAK,kBAAkB;AAEvB,SAAK,eAAe,oBAAI,IAAI;AAAA,EAC9B;AAAA,EAEA,UAAmB;AACjB,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,EAAE,WAA4B;AAC5B,WAAO,KAAK,aAAa,IAAI,SAAS;AAAA,EACxC;AAAA,EAEA,OAAO,MAAM,YAAgC,QAAyB;AACpE,WAAO,SAAS,OAAO,SAAS,SAAS,OAAO,GAAG,MAAM;AAAA,EAC3D;AAAA,EAEA,OAAO,OAAO,YAAgC,QAAyB;AACrE,QAAI,WAAW,cAAc,IAAI,OAAO;AACxC,QAAI,CAAC,UAAU;AACb,iBAAW,SAAS,SAAS,OAAO;AACpC,oBAAc,IAAI,SAAS,QAAQ;AAAA,IACrC;AACA,WAAO,SAAS,OAAO,UAAU,MAAM;AAAA,EACzC;AAAA,EAEA,OAAe,SAAS,SAAuC;AAC7D,QAAIA,QAAO;AACX,QAAI,aAAa;AACjB,aAAS,IAAI,GAAG,IAAI,QAAQ,SAAS,GAAG,KAAK;AAC3C,MAAAA,SAAQ,QAAQ,CAAC;AACjB,YAAM,QAAQ,QAAQ,CAAC,EAAE,YAAY,GAAG;AACxC,YAAM,OAAO,QAAQ,CAAC,EAAE,QAAQ,KAAK,QAAQ,CAAC;AAC9C,UAAI,UAAU,MAAM,SAAS,IAAI;AAC/B,qBAAa;AAAA,MACf,WAAW,SAAS,IAAI;AACtB,qBAAa;AAAA,MACf;AACA,MAAAA,SAAQ,aAAa,aAAa,gBAAgB,CAAC;AAAA,IACrD;AACA,IAAAA,SAAQ,QAAQ,QAAQ,SAAS,CAAC;AAElC,UAAM,WAAW,SAAS,cAAc,UAAU;AAClD,aAAS,YAAYA;AACrB,UAAM,SACF,SAAS,cAAc,iBAAiB,SAAS,SAAS,WAAW,eAAe,WAAW,WAAW,IAAI;AAClH,QAAI,aAAa;AACjB,UAAM,iBAAiB,CAAC;AACxB,UAAM,QAAgB,CAAC;AACvB,UAAM,cAAc,CAAC;AACrB,WAAO,OAAO,SAAS,GAAG;AACxB,YAAM,OAAQ,OAAO;AACrB,UAAI,KAAK,aAAa,KAAK,gBAAgB,KAAK,cAAc,GAAG;AAC/D,YAAI,KAAK,aAAa,GAAG,GAAG;AAC1B,sBAAY,KAAK,IAAI;AACrB,gBAAM,KAAK,EAAC,kBAAkB,QAAW,MAAM,QAAW,WAAW,KAAK,aAAa,GAAG,KAAK,GAAE,CAAC;AAClG,eAAK,gBAAgB,GAAG;AAAA,QAC1B;AAEA,cAAM,qBAAqB,CAAC;AAC5B,iBAAS,IAAI,GAAG,IAAI,KAAK,WAAW,QAAQ,KAAK;AAC/C,gBAAM,OAAO,KAAK,WAAW,CAAC,EAAE;AAEhC,cAAI,CAAC,qBAAqB,KAAK,IAAI,KAAK,CAAC,qBAAqB,KAAK,KAAK,WAAW,CAAC,EAAE,KAAK,GAAG;AAC5F;AAAA,UACF;AAEA,6BAAmB,KAAK,IAAI;AAC5B,sBAAY,KAAK,IAAI;AAErB,gBAAM,OAAO;AAAA,YACX,OAAO;AAAA,YACP,OAAO,KAAK,MAAM,oBAAoB;AAAA,YACtC,QAAQ,KAAK,WAAW,CAAC,EAAE,MAAM,MAAM,oBAAoB;AAAA,UAC7D;AACA,wBAAc,KAAK,MAAM,SAAS;AAClC,wBAAc,KAAK,OAAO,SAAS;AACnC,gBAAM,OAAa;AAAA,YACjB,WAAW;AAAA,YACX,kBAAkB;AAAA,YAClB;AAAA,UACF;AACA,gBAAM,KAAK,IAAI;AAAA,QACjB;AACA,iBAAS,IAAI,GAAG,IAAI,mBAAmB,QAAQ,KAAK;AAClD,eAAK,gBAAgB,mBAAmB,CAAC,CAAC;AAAA,QAC5C;AAAA,MACF;AAEA,UAAI,KAAK,aAAa,KAAK,aAAa,YAAY,IAAI,EAAE,QAAQ,UAAU,MAAM,IAAI;AACpF,cAAM,QAAQ,YAAY,IAAI,EAAE,MAAM,eAAe;AACrD,oBAAY,MAAM,MAAM,MAAM,SAAS,CAAC,CAAC;AACzC,cAAM,aAAc,KAAK;AACzB,iBAAS,IAAI,GAAG,IAAI,MAAM,SAAS,GAAG,KAAK;AACzC,cAAI,MAAM,CAAC,GAAG;AACZ,uBAAW,aAAa,SAAS,eAAe,MAAM,CAAC,CAAC,GAAG,IAAI;AAAA,UACjE;AACA,gBAAM,gBAAgB,SAAS,cAAc,MAAM;AACnD,sBAAY,KAAK,aAAa;AAC9B,gBAAM,KAAK,EAAC,MAAM,QAAW,WAAW,QAAW,kBAAkB,aAAY,CAAC;AAClF,qBAAW,aAAa,eAAe,IAAI;AAAA,QAC7C;AAAA,MACF;AAEA,UAAI,KAAK,aAAa,KAAK,cACtB,CAAC,KAAK,mBAAmB,KAAK,gBAAgB,aAAa,KAAK,kBAChE,CAAC,KAAK,eAAe,KAAK,YAAY,aAAa,KAAK,iBAAiB,QAAQ,KAAK,YAAY,IAAI,CAAC,GAAG;AAC7G,uBAAe,KAAK,IAAI;AAAA,MAC1B;AAAA,IACF;AAEA,aAAS,IAAI,GAAG,IAAI,YAAY,QAAQ,KAAK;AAC3C,kBAAY,CAAC,EAAE,UAAU,IAAI,kBAAkB,CAAC,CAAC;AAAA,IACnD;AAEA,eAAW,iBAAiB,gBAAgB;AAC1C,oBAAc,OAAO;AAAA,IACvB;AACA,WAAO,EAAC,UAAU,MAAK;AAAA,EACzB;AAAA;AAAA,EAGA,OAAe,OAAO,UAAoB,QAAyB;AACjE,UAAM,UAAU,SAAS,SAAS,cAAc,WAAW,SAAS,SAAS,SAAS,IAAI;AAC1F,UAAM,gBAAiB,QAAQ,eAAe,QAAQ,YAAY,QAAQ,aAAa;AACvF,UAAM,SAAS,IAAI,SAAS,aAAa;AAEzC,UAAM,gBAAgB,CAAC;AACvB,aAAS,IAAI,GAAG,IAAI,SAAS,MAAM,QAAQ,KAAK;AAC9C,YAAM,YAAY,kBAAkB,CAAC;AACrC,YAAM,UAAW,QAAQ,cAAc,MAAM,SAAS;AACtD,cAAQ,UAAU,OAAO,SAAS;AAClC,oBAAc,KAAK,OAAO;AAAA,IAC5B;AAEA,aAAS,YAAY,GAAG,YAAY,SAAS,MAAM,QAAQ,aAAa;AACtE,YAAM,OAAO,SAAS,MAAM,SAAS;AACrC,YAAM,UAAU,cAAc,SAAS;AACvC,UAAI,KAAK,cAAc,QAAW;AAChC,eAAO,aAAa,IAAI,KAAK,WAAW,OAAO;AAAA,MACjD,WAAW,KAAK,qBAAqB,QAAW;AAC9C,cAAM,QAAQ,OAAO,KAAK,gBAAgB;AAC1C,QAAC,QAAQ,WAA2B,aAAa,KAAK,aAAa,KAAK,GAAG,OAAO;AAAA,MACpF,WAAW,KAAK,SAAS,QAAW;AAClC,YAAI,KAAK,KAAK,MAAM,WAAW,KAAK,KAAK,KAAK,OAAO,WAAW,KAC5D,OAAO,OAAO,KAAK,KAAK,KAAK,MAAM,YAAY;AACjD,iBAAO,KAAK,KAAK,KAAK,EAAE,KAAK,MAAM,OAAO;AAAA,QAC5C,OAAO;AACL,cAAI,OAAO,KAAK,KAAK,MAAM,CAAC;AAC5B,mBAAS,IAAI,GAAG,IAAI,KAAK,KAAK,MAAM,QAAQ,KAAK;AAC/C,oBAAQ,OAAO,KAAK,KAAK,QAAQ,IAAI,CAAC;AACtC,oBAAQ,KAAK,KAAK,MAAM,CAAC;AAAA,UAC3B;AACA,cAAI,MAAM;AACR,gBAAI,QAAQ,KAAK,KAAK,OAAO,CAAC;AAC9B,qBAAS,IAAI,GAAG,IAAI,KAAK,KAAK,OAAO,QAAQ,KAAK;AAChD,uBAAS,OAAO,KAAK,KAAK,QAAQ,KAAK,KAAK,MAAM,SAAS,IAAI,IAAI,CAAC;AACpE,uBAAS,KAAK,KAAK,OAAO,CAAC;AAAA,YAC7B;AACA,oBAAQ,aAAa,MAAM,KAAK;AAAA,UAClC;AAAA,QACF;AAAA,MACF,OAAO;AACL,cAAM,IAAI,MAAM,iBAAiB;AAAA,MACnC;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA;AAAA,EAGA,OAAe,aAAa,OAAkB;AAC5C,QAAI,iBAAiB,MAAM;AACzB,aAAO;AAAA,IACT;AACA,QAAI,iBAAiB,UAAU;AAC7B,aAAO,MAAM;AAAA,IACf;AACA,QAAI,MAAM,QAAQ,KAAK,GAAG;AACxB,YAAM,OAAO,SAAS,uBAAuB;AAC7C,iBAAW,KAAK,OAAO;AACrB,aAAK,YAAY,KAAK,aAAa,CAAC,CAAC;AAAA,MACvC;AACA,aAAO;AAAA,IACT;AACA,WAAO,SAAS,eAAe,OAAO,KAAK,CAAC;AAAA,EAC9C;AACF;AAEO,aAAM,aAAa;AAC1B,MAAM,kBAAkB;AACjB,aAAM,kBAAkB,CAAC,UAA0B,uBAAuB;AACjF,MAAM,uBAAuB;AAC7B,MAAM,oBAAoB,CAAC,UAA0B,oBAAoB;AACzE,MAAM,gBAAgB,oBAAI,IAAkC;AAErD,aAAM,OAAO,CAAC,YAAgC,WAA2B;AAC9E,SAAO,SAAS,OAAO,SAAS,GAAG,MAAM,EAAE,QAAQ;AACrD;",
  "names": ["html"]
}
