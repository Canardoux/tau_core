{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/ui/legacy/InplaceEditor.ts"],
  "sourcesContent": ["// Copyright 2014 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Platform from '../../core/platform/platform.js';\n\nimport * as ARIAUtils from './ARIAUtils.js';\nimport {Keys} from './KeyboardShortcut.js';\nimport {ElementFocusRestorer, markBeingEdited} from './UIUtils.js';\n\nlet inplaceEditorInstance: InplaceEditor<unknown>|null = null;\n\nexport class InplaceEditor<T> {\n  private focusRestorer?: ElementFocusRestorer;\n  static startEditing<T>(element: Element, config: Config<T>): Controller|null {\n    if (!inplaceEditorInstance) {\n      inplaceEditorInstance = new InplaceEditor();\n    }\n    return inplaceEditorInstance.startEditing(element, config as Config<unknown>);\n  }\n\n  editorContent(editingContext: EditingContext<T>): string {\n    const element = editingContext.element;\n    if (element.tagName === 'INPUT' && (element as HTMLInputElement).type === 'text') {\n      return (element as HTMLInputElement).value;\n    }\n\n    return element.textContent || '';\n  }\n\n  setUpEditor(editingContext: EditingContext<T>): void {\n    const element = (editingContext.element as HTMLElement);\n    element.classList.add('editing');\n    element.setAttribute('contenteditable', 'plaintext-only');\n\n    const oldRole = element.getAttribute('role');\n    ARIAUtils.markAsTextBox(element);\n    editingContext.oldRole = oldRole;\n\n    // Using element.getAttribute('tabIndex') instead of element.tabIndex so\n    // that we do not get a default value if the tabIndex attribute is not set.\n    const oldTabIndex = element.getAttribute('tabIndex');\n    if (typeof oldTabIndex !== 'number' || oldTabIndex < 0) {\n      element.tabIndex = 0;\n    }\n    this.focusRestorer = new ElementFocusRestorer(element);\n    editingContext.oldTabIndex = oldTabIndex;\n  }\n\n  closeEditor(editingContext: EditingContext<T>): void {\n    const element = (editingContext.element as HTMLElement);\n    element.classList.remove('editing');\n    element.removeAttribute('contenteditable');\n\n    if (typeof editingContext.oldRole !== 'string') {\n      element.removeAttribute('role');\n    } else {\n      element.setAttribute('role', editingContext.oldRole);\n    }\n\n    if (typeof editingContext.oldTabIndex !== 'number') {\n      element.removeAttribute('tabIndex');\n    } else {\n      element.setAttribute('tabIndex', editingContext.oldTabIndex);\n    }\n    element.scrollTop = 0;\n    element.scrollLeft = 0;\n  }\n\n  cancelEditing(editingContext: EditingContext<T>): void {\n    const element = (editingContext.element as HTMLElement);\n    if (element.tagName === 'INPUT' && (element as HTMLInputElement).type === 'text') {\n      (element as HTMLInputElement).value = editingContext.oldText || '';\n    } else {\n      element.textContent = editingContext.oldText;\n    }\n  }\n\n  startEditing(element: Element, config: Config<T>): Controller|null {\n    if (!markBeingEdited(element, true)) {\n      return null;\n    }\n\n    const editingContext: EditingContext<T> = {element, config, oldRole: null, oldTabIndex: null, oldText: null};\n    const committedCallback = config.commitHandler;\n    const cancelledCallback = config.cancelHandler;\n    const pasteCallback = config.pasteHandler;\n    const context = config.context;\n    let moveDirection = '';\n    const self = this;\n\n    this.setUpEditor(editingContext);\n\n    editingContext.oldText = this.editorContent(editingContext);\n\n    function blurEventListener(e?: Event): void {\n      if (!config.blurHandler(element, e)) {\n        return;\n      }\n      editingCommitted.call(element);\n    }\n\n    function cleanUpAfterEditing(): void {\n      markBeingEdited(element, false);\n\n      element.removeEventListener('blur', blurEventListener, false);\n      element.removeEventListener('keydown', keyDownEventListener, true);\n      if (pasteCallback) {\n        element.removeEventListener('paste', pasteEventListener, true);\n      }\n\n      if (self.focusRestorer) {\n        self.focusRestorer.restore();\n      }\n      self.closeEditor(editingContext);\n    }\n\n    function editingCancelled(this: Element): void {\n      self.cancelEditing(editingContext);\n      cleanUpAfterEditing();\n      cancelledCallback(this, context);\n    }\n\n    function editingCommitted(this: Element): void {\n      cleanUpAfterEditing();\n\n      committedCallback(this, self.editorContent(editingContext), editingContext.oldText, context, moveDirection);\n      element.dispatchEvent(new Event('change'));\n    }\n\n    function defaultFinishHandler(event: KeyboardEvent): string {\n      if (event.key === 'Enter') {\n        return 'commit';\n      }\n      if (event.keyCode === Keys.Esc.code || event.key === Platform.KeyboardUtilities.ESCAPE_KEY) {\n        return 'cancel';\n      }\n      if (event.key === 'Tab') {\n        return 'move-' + (event.shiftKey ? 'backward' : 'forward');\n      }\n      return '';\n    }\n\n    function handleEditingResult(result: string|undefined, event: Event): void {\n      if (result === 'commit') {\n        editingCommitted.call(element);\n        event.consume(true);\n      } else if (result === 'cancel') {\n        editingCancelled.call(element);\n        event.consume(true);\n      } else if (result && result.startsWith('move-')) {\n        moveDirection = result.substring(5);\n        if ((event as KeyboardEvent).key === 'Tab') {\n          event.consume(true);\n        }\n        blurEventListener();\n      }\n    }\n\n    function pasteEventListener(event: Event): void {\n      if (!pasteCallback) {\n        return;\n      }\n      const result = pasteCallback(event);\n      handleEditingResult(result, event);\n    }\n\n    function keyDownEventListener(event: Event): void {\n      let result = defaultFinishHandler((event as KeyboardEvent));\n      if (!result && config.postKeydownFinishHandler) {\n        const postKeydownResult = config.postKeydownFinishHandler(event);\n        if (postKeydownResult) {\n          result = postKeydownResult;\n        }\n      }\n      handleEditingResult(result, event);\n    }\n\n    element.addEventListener('blur', blurEventListener, false);\n    element.addEventListener('keydown', keyDownEventListener, true);\n    if (pasteCallback !== undefined) {\n      element.addEventListener('paste', pasteEventListener, true);\n    }\n\n    const handle = {cancel: editingCancelled.bind(element), commit: editingCommitted.bind(element)};\n    return handle;\n  }\n}\n\nexport type CommitHandler<T> =\n    (element: Element, newText: string, oldText: string|null, context: T, moveDirection: string) => void;\nexport type CancelHandler<T> = (element: Element, context: T) => void;\nexport type BlurHandler = (element: Element, event?: Event) => boolean;\n\nexport class Config<T> {\n  commitHandler: CommitHandler<T>;\n  cancelHandler: CancelHandler<T>;\n  context: T;\n  blurHandler: BlurHandler;\n  pasteHandler?: EventHandler;\n  postKeydownFinishHandler?: EventHandler;\n\n  constructor(\n      commitHandler: CommitHandler<T>,\n      cancelHandler: CancelHandler<T>,\n      context: T,\n      blurHandler: BlurHandler = () => true,\n  ) {\n    this.commitHandler = commitHandler;\n    this.cancelHandler = cancelHandler;\n    this.context = context;\n    this.blurHandler = blurHandler;\n  }\n\n  setPasteHandler(pasteHandler: EventHandler): void {\n    this.pasteHandler = pasteHandler;\n  }\n\n  setPostKeydownFinishHandler(postKeydownFinishHandler: EventHandler): void {\n    this.postKeydownFinishHandler = postKeydownFinishHandler;\n  }\n}\n\nexport type EventHandler = (event: Event) => string|undefined;\n\nexport interface Controller {\n  cancel: () => void;\n  commit: () => void;\n}\n\nexport interface EditingContext<T> {\n  element: Element;\n  config: Config<T>;\n  oldRole: string|null;\n  oldText: string|null;\n  oldTabIndex: string|null;\n}\n"],
  "mappings": "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",
  "names": []
}
