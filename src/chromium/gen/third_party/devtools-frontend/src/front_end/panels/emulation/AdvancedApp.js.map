{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/panels/emulation/AdvancedApp.ts"],
  "sourcesContent": ["// Copyright 2014 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as ThemeSupport from '../../ui/legacy/theme_support/theme_support.js';\n\nimport {DeviceModeWrapper} from './DeviceModeWrapper.js';\nimport {type Bounds, Events, InspectedPagePlaceholder} from './InspectedPagePlaceholder.js';\n\nlet appInstance: AdvancedApp;\n\nexport class AdvancedApp implements Common.App.App {\n  private rootSplitWidget!: UI.SplitWidget.SplitWidget;\n  private deviceModeView!: DeviceModeWrapper;\n  private inspectedPagePlaceholder!: InspectedPagePlaceholder;\n  private toolboxWindow?: Window|null;\n  private toolboxRootView?: UI.RootView.RootView;\n  private changingDockSide?: boolean;\n  private toolboxDocument?: Document;\n\n  constructor() {\n    UI.DockController.DockController.instance().addEventListener(\n        UI.DockController.Events.BEFORE_DOCK_SIDE_CHANGED, this.openToolboxWindow, this);\n  }\n\n  /**\n   * Note: it's used by toolbox.ts without real type checks.\n   */\n  static instance(): AdvancedApp {\n    if (!appInstance) {\n      appInstance = new AdvancedApp();\n    }\n    return appInstance;\n  }\n\n  presentUI(document: Document): void {\n    const rootView = new UI.RootView.RootView();\n\n    this.rootSplitWidget =\n        new UI.SplitWidget.SplitWidget(false, true, 'inspector-view.split-view-state', 555, 300, true);\n    this.rootSplitWidget.show(rootView.element);\n    this.rootSplitWidget.setSidebarWidget(UI.InspectorView.InspectorView.instance());\n    this.rootSplitWidget.setDefaultFocusedChild(UI.InspectorView.InspectorView.instance());\n    UI.InspectorView.InspectorView.instance().setOwnerSplit(this.rootSplitWidget);\n\n    this.inspectedPagePlaceholder = InspectedPagePlaceholder.instance();\n    this.inspectedPagePlaceholder.addEventListener(Events.UPDATE, this.onSetInspectedPageBounds.bind(this), this);\n    this.deviceModeView =\n        DeviceModeWrapper.instance({inspectedPagePlaceholder: this.inspectedPagePlaceholder, forceNew: false});\n\n    UI.DockController.DockController.instance().addEventListener(\n        UI.DockController.Events.BEFORE_DOCK_SIDE_CHANGED, this.onBeforeDockSideChange, this);\n    UI.DockController.DockController.instance().addEventListener(\n        UI.DockController.Events.DOCK_SIDE_CHANGED, this.onDockSideChange, this);\n    UI.DockController.DockController.instance().addEventListener(\n        UI.DockController.Events.AFTER_DOCK_SIDE_CHANGED, this.onAfterDockSideChange, this);\n    this.onDockSideChange();\n\n    console.timeStamp('AdvancedApp.attachToBody');\n    rootView.attachToDocument(document);\n    rootView.focus();\n    this.inspectedPagePlaceholder.update();\n  }\n\n  private openToolboxWindow(event: Common.EventTarget.EventTargetEvent<UI.DockController.ChangeEvent>): void {\n    if (event.data.to !== UI.DockController.DockState.UNDOCKED) {\n      return;\n    }\n\n    if (this.toolboxWindow) {\n      return;\n    }\n\n    const url = window.location.href.replace('devtools_app.html', 'device_mode_emulation_frame.html');\n    this.toolboxWindow = window.open(url, undefined);\n  }\n\n  deviceModeEmulationFrameLoaded(toolboxDocument: Document): void {\n    ThemeSupport.ThemeSupport.instance().addDocumentToTheme(toolboxDocument);\n    UI.UIUtils.initializeUIUtils(toolboxDocument);\n    UI.UIUtils.addPlatformClass(toolboxDocument.documentElement);\n    UI.UIUtils.installComponentRootStyles(toolboxDocument.body);\n    UI.ContextMenu.ContextMenu.installHandler(toolboxDocument);\n\n    this.toolboxRootView = new UI.RootView.RootView();\n    this.toolboxRootView.attachToDocument(toolboxDocument);\n\n    this.toolboxDocument = toolboxDocument;\n\n    this.updateDeviceModeView();\n  }\n\n  private updateDeviceModeView(): void {\n    if (this.isDocked()) {\n      this.rootSplitWidget.setMainWidget(this.deviceModeView);\n    } else if (this.toolboxRootView) {\n      this.deviceModeView.show(this.toolboxRootView.element);\n    }\n  }\n\n  private onBeforeDockSideChange(event: Common.EventTarget.EventTargetEvent<UI.DockController.ChangeEvent>): void {\n    if (event.data.to === UI.DockController.DockState.UNDOCKED && this.toolboxRootView) {\n      // Hide inspectorView and force layout to mimic the undocked state.\n      this.rootSplitWidget.hideSidebar();\n      this.inspectedPagePlaceholder.update();\n    }\n\n    this.changingDockSide = true;\n  }\n\n  private onDockSideChange(event?: Common.EventTarget.EventTargetEvent<UI.DockController.ChangeEvent>): void {\n    this.updateDeviceModeView();\n\n    const toDockSide = event ? event.data.to : UI.DockController.DockController.instance().dockSide();\n    if (toDockSide === undefined) {\n      throw new Error('Got onDockSideChange event with unexpected undefined for dockSide()');\n    }\n    if (toDockSide === UI.DockController.DockState.UNDOCKED) {\n      this.updateForUndocked();\n    } else if (this.toolboxRootView && event && event.data.from === UI.DockController.DockState.UNDOCKED) {\n      // Don't update yet for smooth transition.\n      this.rootSplitWidget.hideSidebar();\n    } else {\n      this.updateForDocked(toDockSide);\n    }\n  }\n\n  private onAfterDockSideChange(event: Common.EventTarget.EventTargetEvent<UI.DockController.ChangeEvent>): void {\n    // We may get here on the first dock side change while loading without BeforeDockSideChange.\n    if (!this.changingDockSide) {\n      return;\n    }\n    if (event.data.from && event.data.from === UI.DockController.DockState.UNDOCKED) {\n      this.updateForDocked(event.data.to);\n    }\n    this.changingDockSide = false;\n    this.inspectedPagePlaceholder.update();\n  }\n\n  private updateForDocked(dockSide: UI.DockController.DockState): void {\n    const resizerElement = (this.rootSplitWidget.resizerElement() as HTMLElement);\n    resizerElement.style.transform = dockSide === UI.DockController.DockState.RIGHT ? 'translateX(2px)' :\n        dockSide === UI.DockController.DockState.LEFT                               ? 'translateX(-2px)' :\n                                                                                      '';\n    this.rootSplitWidget.setVertical(\n        dockSide === UI.DockController.DockState.RIGHT || dockSide === UI.DockController.DockState.LEFT);\n    this.rootSplitWidget.setSecondIsSidebar(\n        dockSide === UI.DockController.DockState.RIGHT || dockSide === UI.DockController.DockState.BOTTOM);\n    this.rootSplitWidget.toggleResizer(this.rootSplitWidget.resizerElement(), true);\n    this.rootSplitWidget.toggleResizer(\n        UI.InspectorView.InspectorView.instance().topResizerElement(), dockSide === UI.DockController.DockState.BOTTOM);\n    this.rootSplitWidget.showBoth();\n  }\n\n  private updateForUndocked(): void {\n    this.rootSplitWidget.toggleResizer(this.rootSplitWidget.resizerElement(), false);\n    this.rootSplitWidget.toggleResizer(UI.InspectorView.InspectorView.instance().topResizerElement(), false);\n    this.rootSplitWidget.hideMain();\n  }\n\n  private isDocked(): boolean {\n    return UI.DockController.DockController.instance().dockSide() !== UI.DockController.DockState.UNDOCKED;\n  }\n\n  private onSetInspectedPageBounds(event: Common.EventTarget.EventTargetEvent<Bounds>): void {\n    if (this.changingDockSide) {\n      return;\n    }\n    const window = this.inspectedPagePlaceholder.element.window();\n    if (!window.innerWidth || !window.innerHeight) {\n      return;\n    }\n    if (!this.inspectedPagePlaceholder.isShowing()) {\n      return;\n    }\n    const bounds = event.data;\n    console.timeStamp('AdvancedApp.setInspectedPageBounds');\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.setInspectedPageBounds(bounds);\n  }\n}\n\n// Export required for usage in toolbox.ts\n// @ts-ignore Exported for Tests.js\nglobalThis.Emulation = globalThis.Emulation || {};\n// @ts-ignore Exported for Tests.js\nglobalThis.Emulation.AdvancedApp = AdvancedApp;\n\nlet advancedAppProviderInstance: AdvancedAppProvider;\n\nexport class AdvancedAppProvider implements Common.AppProvider.AppProvider {\n  static instance(opts: {\n    forceNew: boolean|null,\n  } = {forceNew: null}): AdvancedAppProvider {\n    const {forceNew} = opts;\n    if (!advancedAppProviderInstance || forceNew) {\n      advancedAppProviderInstance = new AdvancedAppProvider();\n    }\n\n    return advancedAppProviderInstance;\n  }\n\n  createApp(): Common.App.App {\n    return AdvancedApp.instance();\n  }\n}\n"],
  "mappings": "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",
  "names": ["window"]
}
