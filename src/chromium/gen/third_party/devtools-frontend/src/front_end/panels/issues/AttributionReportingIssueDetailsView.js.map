{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/panels/issues/AttributionReportingIssueDetailsView.ts"],
  "sourcesContent": ["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as IssuesManager from '../../models/issues_manager/issues_manager.js';\n\nimport {AffectedItem, AffectedResourcesView} from './AffectedResourcesView.js';\n\nconst UIStrings = {\n  /**\n   * @description Label for number of rows in the issue details table.\n   */\n  nViolations: '{n, plural, =1 {# violation} other {# violations}}',\n  /**\n   * @description Noun, label for the column showing the associated HTML element in the issue details table.\n   */\n  element: 'Element',\n  /**\n   * @description Noun, label for the column showing the invalid header value in the issue details table.\n   */\n  invalidHeaderValue: 'Invalid Header Value',\n  /**\n   * @description Noun, label for the column showing the associated network request in the issue details table.\n   */\n  request: 'Request',\n  /**\n   * @description Label for the column showing the invalid URL used in an HTML anchor element (\"a link\").\n   * A origin is (roughly said) the front part of a URL.\n   */\n  untrustworthyOrigin: 'Untrustworthy origin',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/issues/AttributionReportingIssueDetailsView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class AttributionReportingIssueDetailsView extends AffectedResourcesView {\n  protected override getResourceNameWithCount(count: number): string {\n    return i18nString(UIStrings.nViolations, {n: count});\n  }\n\n  override update(): void {\n    this.clear();\n    const issues = this.issue.getAttributionReportingIssues();\n    const issue = issues.values().next();\n    if (issue.done) {\n      this.updateAffectedResourceCount(0);\n    } else {\n      this.#appendDetails(issue.value.code(), issues);\n    }\n  }\n\n  #appendDetails(\n      issueCode: IssuesManager.AttributionReportingIssue.IssueCode,\n      issues: Iterable<IssuesManager.AttributionReportingIssue.AttributionReportingIssue>): void {\n    const header = document.createElement('tr');\n    switch (issueCode) {\n      case IssuesManager.AttributionReportingIssue.IssueCode.INVALID_REGISTER_SOURCE_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.INVALID_REGISTER_TRIGGER_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.INVALID_REGISTER_OS_SOURCE_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.INVALID_REGISTER_OS_TRIGGER_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.OS_SOURCE_IGNORED:\n      case IssuesManager.AttributionReportingIssue.IssueCode.OS_TRIGGER_IGNORED:\n      case IssuesManager.AttributionReportingIssue.IssueCode.SOURCE_IGNORED:\n      case IssuesManager.AttributionReportingIssue.IssueCode.TRIGGER_IGNORED:\n      case IssuesManager.AttributionReportingIssue.IssueCode.INVALID_INFO_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NAVIGATION_REGISTRATION_UNIQUE_SCOPE_ALREADY_SET:\n        this.appendColumnTitle(header, i18nString(UIStrings.request));\n        this.appendColumnTitle(header, i18nString(UIStrings.invalidHeaderValue));\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.INSECURE_CONTEXT:\n      case IssuesManager.AttributionReportingIssue.IssueCode.UNTRUSTWORTHY_REPORTING_ORIGIN:\n        this.appendColumnTitle(header, i18nString(UIStrings.element));\n        this.appendColumnTitle(header, i18nString(UIStrings.request));\n        this.appendColumnTitle(header, i18nString(UIStrings.untrustworthyOrigin));\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.PERMISSION_POLICY_DISABLED:\n        this.appendColumnTitle(header, i18nString(UIStrings.element));\n        this.appendColumnTitle(header, i18nString(UIStrings.request));\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.SOURCE_AND_TRIGGER_HEADERS:\n      case IssuesManager.AttributionReportingIssue.IssueCode.WEB_AND_OS_HEADERS:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NO_WEB_OR_OS_SUPPORT:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NO_REGISTER_SOURCE_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NO_REGISTER_TRIGGER_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NO_REGISTER_OS_SOURCE_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NO_REGISTER_OS_TRIGGER_HEADER:\n        this.appendColumnTitle(header, i18nString(UIStrings.request));\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.NAVIGATION_REGISTRATION_WITHOUT_TRANSIENT_USER_ACTIVATION:\n        this.appendColumnTitle(header, i18nString(UIStrings.element));\n        break;\n    }\n\n    this.affectedResources.appendChild(header);\n    let count = 0;\n    for (const issue of issues) {\n      count++;\n      void this.#appendDetail(issueCode, issue);\n    }\n    this.updateAffectedResourceCount(count);\n  }\n\n  async #appendDetail(\n      issueCode: IssuesManager.AttributionReportingIssue.IssueCode,\n      issue: IssuesManager.AttributionReportingIssue.AttributionReportingIssue): Promise<void> {\n    const element = document.createElement('tr');\n    element.classList.add('affected-resource-directive');\n\n    const details = issue.issueDetails;\n\n    switch (issueCode) {\n      case IssuesManager.AttributionReportingIssue.IssueCode.INVALID_REGISTER_SOURCE_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.INVALID_REGISTER_TRIGGER_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.INVALID_REGISTER_OS_SOURCE_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.INVALID_REGISTER_OS_TRIGGER_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.OS_SOURCE_IGNORED:\n      case IssuesManager.AttributionReportingIssue.IssueCode.OS_TRIGGER_IGNORED:\n      case IssuesManager.AttributionReportingIssue.IssueCode.SOURCE_IGNORED:\n      case IssuesManager.AttributionReportingIssue.IssueCode.TRIGGER_IGNORED:\n      case IssuesManager.AttributionReportingIssue.IssueCode.INVALID_INFO_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NAVIGATION_REGISTRATION_UNIQUE_SCOPE_ALREADY_SET:\n        this.#appendRequestOrEmptyCell(element, details.request);\n        this.appendIssueDetailCell(element, details.invalidParameter || '');\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.INSECURE_CONTEXT:\n      case IssuesManager.AttributionReportingIssue.IssueCode.UNTRUSTWORTHY_REPORTING_ORIGIN:\n        await this.#appendElementOrEmptyCell(element, issue);\n        this.#appendRequestOrEmptyCell(element, details.request);\n        this.appendIssueDetailCell(element, details.invalidParameter || '');\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.PERMISSION_POLICY_DISABLED:\n        await this.#appendElementOrEmptyCell(element, issue);\n        this.#appendRequestOrEmptyCell(element, details.request);\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.SOURCE_AND_TRIGGER_HEADERS:\n      case IssuesManager.AttributionReportingIssue.IssueCode.WEB_AND_OS_HEADERS:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NO_WEB_OR_OS_SUPPORT:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NO_REGISTER_SOURCE_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NO_REGISTER_TRIGGER_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NO_REGISTER_OS_SOURCE_HEADER:\n      case IssuesManager.AttributionReportingIssue.IssueCode.NO_REGISTER_OS_TRIGGER_HEADER:\n        this.#appendRequestOrEmptyCell(element, details.request);\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.NAVIGATION_REGISTRATION_WITHOUT_TRANSIENT_USER_ACTIVATION:\n        await this.#appendElementOrEmptyCell(element, issue);\n        break;\n    }\n\n    this.affectedResources.appendChild(element);\n  }\n\n  async #appendElementOrEmptyCell(\n      parent: HTMLElement, issue: IssuesManager.AttributionReportingIssue.AttributionReportingIssue): Promise<void> {\n    const details = issue.issueDetails;\n    if (details.violatingNodeId !== undefined) {\n      const target = issue.model()?.target() || null;\n      parent.appendChild(await this.createElementCell(\n          {backendNodeId: details.violatingNodeId, target, nodeName: 'Attribution source element'},\n          issue.getCategory()));\n    } else {\n      this.appendIssueDetailCell(parent, '');\n    }\n  }\n\n  #appendRequestOrEmptyCell(parent: HTMLElement, request?: Protocol.Audits.AffectedRequest): void {\n    if (!request) {\n      this.appendIssueDetailCell(parent, '');\n      return;\n    }\n\n    const opts = {\n      additionalOnClickAction(): void {\n        Host.userMetrics.issuesPanelResourceOpened(\n            IssuesManager.Issue.IssueCategory.ATTRIBUTION_REPORTING, AffectedItem.REQUEST);\n      },\n    };\n    parent.appendChild(this.createRequestCell(request, opts));\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
