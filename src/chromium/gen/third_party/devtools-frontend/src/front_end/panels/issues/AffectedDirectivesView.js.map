{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/panels/issues/AffectedDirectivesView.ts"],
  "sourcesContent": ["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as IssuesManager from '../../models/issues_manager/issues_manager.js';\nimport * as IssuesComponents from './components/components.js';\n\nimport {AffectedItem, AffectedResourcesView} from './AffectedResourcesView.js';\n\nconst UIStrings = {\n  /**\n   *@description Singular or plural label for number of affected CSP (content security policy,\n   * see https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP) directives in issue view.\n   */\n  nDirectives: '{n, plural, =1 {# directive} other {# directives}}',\n  /**\n   *@description Indicates that a CSP error should be treated as a warning\n   */\n  reportonly: 'report-only',\n  /**\n   *@description The kind of resolution for a mixed content issue\n   */\n  blocked: 'blocked',\n  /**\n   *@description Tooltip for button linking to the Elements panel\n   */\n  clickToRevealTheViolatingDomNode: 'Click to reveal the violating DOM node in the Elements panel',\n  /**\n   *@description Header for the section listing affected directives\n   */\n  directiveC: 'Directive',\n  /**\n   *@description Label for the column in the element list in the CSS overview report\n   */\n  element: 'Element',\n  /**\n   *@description Header for the source location column\n   */\n  sourceLocation: 'Source location',\n  /**\n   *@description Text for the status of something\n   */\n  status: 'Status',\n  /**\n   *@description Text that refers to the resources of the web page\n   */\n  resourceC: 'Resource',\n};\n\nconst str_ = i18n.i18n.registerUIStrings('panels/issues/AffectedDirectivesView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class AffectedDirectivesView extends AffectedResourcesView {\n  #appendStatus(element: Element, isReportOnly: boolean): void {\n    const status = document.createElement('td');\n    if (isReportOnly) {\n      status.classList.add('affected-resource-report-only-status');\n      status.textContent = i18nString(UIStrings.reportonly);\n    } else {\n      status.classList.add('affected-resource-blocked-status');\n      status.textContent = i18nString(UIStrings.blocked);\n    }\n    element.appendChild(status);\n  }\n\n  protected getResourceNameWithCount(count: number): Platform.UIString.LocalizedString {\n    return i18nString(UIStrings.nDirectives, {n: count});\n  }\n\n  #appendViolatedDirective(element: Element, directive: string): void {\n    const violatedDirective = document.createElement('td');\n    violatedDirective.textContent = directive;\n    element.appendChild(violatedDirective);\n  }\n\n  #appendBlockedURL(element: Element, url: Platform.DevToolsPath.UrlString): void {\n    const info = document.createElement('td');\n    info.classList.add('affected-resource-directive-info');\n    info.textContent = url;\n    element.appendChild(info);\n  }\n\n  #appendBlockedElement(\n      element: Element, nodeId: Protocol.DOM.BackendNodeId|undefined, model: SDK.IssuesModel.IssuesModel): void {\n    const elementsPanelLinkComponent = new IssuesComponents.ElementsPanelLink.ElementsPanelLink();\n    if (nodeId) {\n      const violatingNodeId = nodeId;\n      elementsPanelLinkComponent.title = i18nString(UIStrings.clickToRevealTheViolatingDomNode);\n\n      const onElementRevealIconClick: (arg0?: Event|undefined) => void = () => {\n        const target = model.getTargetIfNotDisposed();\n        if (target) {\n          Host.userMetrics.issuesPanelResourceOpened(this.issue.getCategory(), AffectedItem.ELEMENT);\n          const deferredDOMNode = new SDK.DOMModel.DeferredDOMNode(target, violatingNodeId);\n          void Common.Revealer.reveal(deferredDOMNode);\n        }\n      };\n\n      const onElementRevealIconMouseEnter: (arg0?: Event|undefined) => void = () => {\n        const target = model.getTargetIfNotDisposed();\n        if (target) {\n          const deferredDOMNode = new SDK.DOMModel.DeferredDOMNode(target, violatingNodeId);\n          if (deferredDOMNode) {\n            deferredDOMNode.highlight();\n          }\n        }\n      };\n\n      const onElementRevealIconMouseLeave: (arg0?: Event|undefined) => void = () => {\n        SDK.OverlayModel.OverlayModel.hideDOMNodeHighlight();\n      };\n\n      elementsPanelLinkComponent\n          .data = {onElementRevealIconClick, onElementRevealIconMouseEnter, onElementRevealIconMouseLeave};\n    }\n\n    const violatingNode = document.createElement('td');\n    violatingNode.classList.add('affected-resource-csp-info-node');\n    violatingNode.appendChild(elementsPanelLinkComponent);\n    element.appendChild(violatingNode);\n  }\n\n  #appendAffectedContentSecurityPolicyDetails(\n      cspIssues: Iterable<IssuesManager.ContentSecurityPolicyIssue.ContentSecurityPolicyIssue>): void {\n    const header = document.createElement('tr');\n    if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.inlineViolationCode) {\n      this.appendColumnTitle(header, i18nString(UIStrings.directiveC));\n      this.appendColumnTitle(header, i18nString(UIStrings.element));\n      this.appendColumnTitle(header, i18nString(UIStrings.sourceLocation));\n      this.appendColumnTitle(header, i18nString(UIStrings.status));\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.urlViolationCode) {\n      this.appendColumnTitle(header, i18nString(UIStrings.resourceC), 'affected-resource-directive-info-header');\n      this.appendColumnTitle(header, i18nString(UIStrings.status));\n      this.appendColumnTitle(header, i18nString(UIStrings.directiveC));\n      this.appendColumnTitle(header, i18nString(UIStrings.sourceLocation));\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.evalViolationCode) {\n      this.appendColumnTitle(header, i18nString(UIStrings.sourceLocation));\n      this.appendColumnTitle(header, i18nString(UIStrings.directiveC));\n      this.appendColumnTitle(header, i18nString(UIStrings.status));\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.trustedTypesSinkViolationCode) {\n      this.appendColumnTitle(header, i18nString(UIStrings.sourceLocation));\n      this.appendColumnTitle(header, i18nString(UIStrings.status));\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.trustedTypesPolicyViolationCode) {\n      this.appendColumnTitle(header, i18nString(UIStrings.sourceLocation));\n      this.appendColumnTitle(header, i18nString(UIStrings.directiveC));\n      this.appendColumnTitle(header, i18nString(UIStrings.status));\n    } else {\n      this.updateAffectedResourceCount(0);\n      return;\n    }\n    this.affectedResources.appendChild(header);\n    let count = 0;\n    for (const cspIssue of cspIssues) {\n      count++;\n      this.#appendAffectedContentSecurityPolicyDetail(cspIssue);\n    }\n    this.updateAffectedResourceCount(count);\n  }\n\n  #appendAffectedContentSecurityPolicyDetail(\n      cspIssue: IssuesManager.ContentSecurityPolicyIssue.ContentSecurityPolicyIssue): void {\n    const element = document.createElement('tr');\n    element.classList.add('affected-resource-directive');\n\n    const cspIssueDetails = cspIssue.details();\n    const location = IssuesManager.Issue.toZeroBasedLocation(cspIssueDetails.sourceCodeLocation);\n    const model = cspIssue.model();\n    const maybeTarget = cspIssue.model()?.getTargetIfNotDisposed();\n    if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.inlineViolationCode && model) {\n      this.#appendViolatedDirective(element, cspIssueDetails.violatedDirective);\n      this.#appendBlockedElement(element, cspIssueDetails.violatingNodeId, model);\n      this.appendSourceLocation(element, location, maybeTarget);\n      this.#appendStatus(element, cspIssueDetails.isReportOnly);\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.urlViolationCode) {\n      const url = cspIssueDetails.blockedURL ? cspIssueDetails.blockedURL as Platform.DevToolsPath.UrlString :\n                                               Platform.DevToolsPath.EmptyUrlString;\n      this.#appendBlockedURL(element, url);\n      this.#appendStatus(element, cspIssueDetails.isReportOnly);\n      this.#appendViolatedDirective(element, cspIssueDetails.violatedDirective);\n      this.appendSourceLocation(element, location, maybeTarget);\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.evalViolationCode) {\n      this.appendSourceLocation(element, location, maybeTarget);\n      this.#appendViolatedDirective(element, cspIssueDetails.violatedDirective);\n      this.#appendStatus(element, cspIssueDetails.isReportOnly);\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.trustedTypesSinkViolationCode) {\n      this.appendSourceLocation(element, location, maybeTarget);\n      this.#appendStatus(element, cspIssueDetails.isReportOnly);\n    } else if (this.issue.code() === IssuesManager.ContentSecurityPolicyIssue.trustedTypesPolicyViolationCode) {\n      this.appendSourceLocation(element, location, maybeTarget);\n      this.#appendViolatedDirective(element, cspIssueDetails.violatedDirective);\n      this.#appendStatus(element, cspIssueDetails.isReportOnly);\n    } else {\n      return;\n    }\n\n    this.affectedResources.appendChild(element);\n  }\n\n  update(): void {\n    this.clear();\n    this.#appendAffectedContentSecurityPolicyDetails(this.issue.getCspIssues());\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
