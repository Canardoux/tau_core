{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/entrypoints/formatter_worker/CSSFormatter.ts"],
  "sourcesContent": ["/*\n * Copyright (C) 2013 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Platform from '../../core/platform/platform.js';\n\nimport type {FormattedContentBuilder} from './FormattedContentBuilder.js';\nimport {createTokenizer} from './FormatterWorker.js';\n\nconst cssTrimEnd = (tokenValue: string): string => {\n  // https://drafts.csswg.org/css-syntax/#whitespace\n  const re = /(?:\\r?\\n|[\\t\\f\\r ])+$/g;\n  return tokenValue.replace(re, '');\n};\n\nexport class CSSFormatter {\n  readonly #builder: FormattedContentBuilder;\n  #toOffset!: number;\n  #fromOffset!: number;\n  #lineEndings!: number[];\n  #lastLine: number;\n  #state: {\n    eatWhitespace: (boolean|undefined),\n    seenProperty: (boolean|undefined),\n    inPropertyValue: (boolean|undefined),\n    afterClosingBrace: (boolean|undefined),\n  };\n  constructor(builder: FormattedContentBuilder) {\n    this.#builder = builder;\n    this.#lastLine = -1;\n    this.#state = {\n      eatWhitespace: undefined,\n      seenProperty: undefined,\n      inPropertyValue: undefined,\n      afterClosingBrace: undefined,\n    };\n  }\n\n  format(text: string, lineEndings: number[], fromOffset: number, toOffset: number): void {\n    this.#lineEndings = lineEndings;\n    this.#fromOffset = fromOffset;\n    this.#toOffset = toOffset;\n    this.#state = {\n      eatWhitespace: undefined,\n      seenProperty: undefined,\n      inPropertyValue: undefined,\n      afterClosingBrace: undefined,\n    };\n    this.#lastLine = -1;\n    const tokenize = createTokenizer('text/css');\n    const oldEnforce = this.#builder.setEnforceSpaceBetweenWords(false);\n    tokenize(text.substring(this.#fromOffset, this.#toOffset), this.#tokenCallback.bind(this));\n    this.#builder.setEnforceSpaceBetweenWords(oldEnforce);\n  }\n\n  #tokenCallback(token: string, type: string|null, startPosition: number): void {\n    startPosition += this.#fromOffset;\n    const startLine = Platform.ArrayUtilities.lowerBound(\n        this.#lineEndings, startPosition, Platform.ArrayUtilities.DEFAULT_COMPARATOR);\n    if (startLine !== this.#lastLine) {\n      this.#state.eatWhitespace = true;\n    }\n    if (type && (/^property/.test(type) || /^variable-2/.test(type)) && !this.#state.inPropertyValue) {\n      this.#state.seenProperty = true;\n    }\n    this.#lastLine = startLine;\n    // https://drafts.csswg.org/css-syntax/#whitespace\n    const isWhitespace = /^(?:\\r?\\n|[\\t\\f\\r ])+$/.test(token);\n    if (isWhitespace) {\n      if (!this.#state.eatWhitespace) {\n        this.#builder.addSoftSpace();\n      }\n      return;\n    }\n    this.#state.eatWhitespace = false;\n    if (token === '\\n') {\n      return;\n    }\n\n    if (token !== '}') {\n      if (this.#state.afterClosingBrace) {\n        this.#builder.addNewLine(true);\n      }\n      this.#state.afterClosingBrace = false;\n    }\n    if (token === '}') {\n      if (this.#state.inPropertyValue) {\n        this.#builder.addNewLine();\n      }\n      this.#builder.decreaseNestingLevel();\n      this.#state.afterClosingBrace = true;\n      this.#state.inPropertyValue = false;\n    } else if (token === ':' && !this.#state.inPropertyValue && this.#state.seenProperty) {\n      this.#builder.addToken(token, startPosition);\n      this.#builder.addSoftSpace();\n      this.#state.eatWhitespace = true;\n      this.#state.inPropertyValue = true;\n      this.#state.seenProperty = false;\n      return;\n    } else if (token === '{') {\n      this.#builder.addSoftSpace();\n      this.#builder.addToken(token, startPosition);\n      this.#builder.addNewLine();\n      this.#builder.increaseNestingLevel();\n      return;\n    }\n\n    this.#builder.addToken(cssTrimEnd(token), startPosition);\n\n    if (type === 'comment' && !this.#state.inPropertyValue && !this.#state.seenProperty) {\n      this.#builder.addNewLine();\n    }\n    if (token === ';' && this.#state.inPropertyValue) {\n      this.#state.inPropertyValue = false;\n      this.#builder.addNewLine();\n    } else if (token === '}') {\n      this.#builder.addNewLine();\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
