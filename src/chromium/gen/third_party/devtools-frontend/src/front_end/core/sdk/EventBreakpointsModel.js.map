{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/core/sdk/EventBreakpointsModel.ts"],
  "sourcesContent": ["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as ProtocolProxyApi from '../../generated/protocol-proxy-api.js';\n\nimport {CategorizedBreakpoint, Category} from './CategorizedBreakpoint.js';\nimport type {EventListenerPausedDetailsAuxData} from './DebuggerModel.js';\nimport {SDKModel} from './SDKModel.js';\nimport {Capability, type Target} from './Target.js';\nimport {type SDKModelObserver, TargetManager} from './TargetManager.js';\n\nexport const enum InstrumentationNames {\n  BEFORE_BIDDER_WORKLET_BIDDING_START = 'beforeBidderWorkletBiddingStart',\n  BEFORE_BIDDER_WORKLET_REPORTING_START = 'beforeBidderWorkletReportingStart',\n  BEFORE_SELLER_WORKLET_SCORING_START = 'beforeSellerWorkletScoringStart',\n  BEFORE_SELLER_WORKLET_REPORTING_START = 'beforeSellerWorkletReportingStart',\n  SET_TIMEOUT = 'setTimeout',\n  CLEAR_TIMEOUT = 'clearTimeout',\n  SET_TIMEOUT_CALLBACK = 'setTimeout.callback',\n  SET_INTERVAL = 'setInterval',\n  CLEAR_INTERVAL = 'clearInterval',\n  SET_INTERVAL_CALLBACK = 'setInterval.callback',\n  SCRIPT_FIRST_STATEMENT = 'scriptFirstStatement',\n  SCRIPT_BLOCKED_BY_CSP = 'scriptBlockedByCSP',\n  SHARED_STORAGE_WORKLET_SCRIPT_FIRST_STATEMENT = 'sharedStorageWorkletScriptFirstStatement',\n  REQUEST_ANIMATION_FRAME = 'requestAnimationFrame',\n  CANCEL_ANIMATION_FRAME = 'cancelAnimationFrame',\n  REQUEST_ANIMATION_FRAME_CALLBACK = 'requestAnimationFrame.callback',\n  WEBGL_ERROR_FIRED = 'webglErrorFired',\n  WEBGL_WARNING_FIRED = 'webglWarningFired',\n  ELEMENT_SET_INNER_HTML = 'Element.setInnerHTML',\n  CANVAS_CONTEXT_CREATED = 'canvasContextCreated',\n  GEOLOCATION_GET_CURRENT_POSITION = 'Geolocation.getCurrentPosition',\n  GEOLOCATION_WATCH_POSITION = 'Geolocation.watchPosition',\n  NOTIFCATION_REQUEST_PERMISSION = 'Notification.requestPermission',\n  DOM_WINDOW_CLOSE = 'DOMWindow.close',\n  DOCUMENT_WRITE = 'Document.write',\n  AUDIO_CONTEXT_CREATED = 'audioContextCreated',\n  AUDIO_CONTEXT_CLOSED = 'audioContextClosed',\n  AUDIO_CONTEXT_RESUMED = 'audioContextResumed',\n  AUDIO_CONTEXT_SUSPENDED = 'audioContextSuspended',\n}\n\nexport class EventBreakpointsModel extends SDKModel<void> {\n  readonly agent: ProtocolProxyApi.EventBreakpointsApi;\n\n  constructor(target: Target) {\n    super(target);\n    this.agent = target.eventBreakpointsAgent();\n  }\n}\n\n// This implementation (as opposed to similar class in DOMDebuggerModel) is for\n// instrumentation breakpoints in targets that run JS but do not have a DOM.\nclass EventListenerBreakpoint extends CategorizedBreakpoint {\n  override setEnabled(enabled: boolean): void {\n    if (this.enabled() === enabled) {\n      return;\n    }\n    super.setEnabled(enabled);\n    for (const model of TargetManager.instance().models(EventBreakpointsModel)) {\n      this.updateOnModel(model);\n    }\n  }\n\n  updateOnModel(model: EventBreakpointsModel): void {\n    if (this.enabled()) {\n      void model.agent.invoke_setInstrumentationBreakpoint({eventName: this.name});\n    } else {\n      void model.agent.invoke_removeInstrumentationBreakpoint({eventName: this.name});\n    }\n  }\n\n  static readonly instrumentationPrefix = 'instrumentation:';\n}\n\nlet eventBreakpointManagerInstance: EventBreakpointsManager;\n\nexport class EventBreakpointsManager implements SDKModelObserver<EventBreakpointsModel> {\n  readonly #eventListenerBreakpointsInternal: EventListenerBreakpoint[] = [];\n\n  constructor() {\n    this.createInstrumentationBreakpoints(Category.AUCTION_WORKLET, [\n      InstrumentationNames.BEFORE_BIDDER_WORKLET_BIDDING_START,\n      InstrumentationNames.BEFORE_BIDDER_WORKLET_REPORTING_START,\n      InstrumentationNames.BEFORE_SELLER_WORKLET_SCORING_START,\n      InstrumentationNames.BEFORE_SELLER_WORKLET_REPORTING_START,\n    ]);\n    this.createInstrumentationBreakpoints(Category.ANIMATION, [\n      InstrumentationNames.REQUEST_ANIMATION_FRAME,\n      InstrumentationNames.CANCEL_ANIMATION_FRAME,\n      InstrumentationNames.REQUEST_ANIMATION_FRAME_CALLBACK,\n    ]);\n    this.createInstrumentationBreakpoints(Category.CANVAS, [\n      InstrumentationNames.CANVAS_CONTEXT_CREATED,\n      InstrumentationNames.WEBGL_ERROR_FIRED,\n      InstrumentationNames.WEBGL_WARNING_FIRED,\n    ]);\n    this.createInstrumentationBreakpoints(Category.GEOLOCATION, [\n      InstrumentationNames.GEOLOCATION_GET_CURRENT_POSITION,\n      InstrumentationNames.GEOLOCATION_WATCH_POSITION,\n    ]);\n    this.createInstrumentationBreakpoints(Category.NOTIFICATION, [\n      InstrumentationNames.NOTIFCATION_REQUEST_PERMISSION,\n    ]);\n    this.createInstrumentationBreakpoints(Category.PARSE, [\n      InstrumentationNames.ELEMENT_SET_INNER_HTML,\n      InstrumentationNames.DOCUMENT_WRITE,\n    ]);\n    this.createInstrumentationBreakpoints(Category.SCRIPT, [\n      InstrumentationNames.SCRIPT_FIRST_STATEMENT,\n      InstrumentationNames.SCRIPT_BLOCKED_BY_CSP,\n    ]);\n    this.createInstrumentationBreakpoints(Category.SHARED_STORAGE_WORKLET, [\n      InstrumentationNames.SHARED_STORAGE_WORKLET_SCRIPT_FIRST_STATEMENT,\n    ]);\n    this.createInstrumentationBreakpoints(Category.TIMER, [\n      InstrumentationNames.SET_TIMEOUT,\n      InstrumentationNames.CLEAR_TIMEOUT,\n      InstrumentationNames.SET_TIMEOUT_CALLBACK,\n      InstrumentationNames.SET_INTERVAL,\n      InstrumentationNames.CLEAR_INTERVAL,\n      InstrumentationNames.SET_INTERVAL_CALLBACK,\n    ]);\n    this.createInstrumentationBreakpoints(Category.WINDOW, [\n      InstrumentationNames.DOM_WINDOW_CLOSE,\n    ]);\n    this.createInstrumentationBreakpoints(Category.WEB_AUDIO, [\n      InstrumentationNames.AUDIO_CONTEXT_CREATED,\n      InstrumentationNames.AUDIO_CONTEXT_CLOSED,\n      InstrumentationNames.AUDIO_CONTEXT_RESUMED,\n      InstrumentationNames.AUDIO_CONTEXT_SUSPENDED,\n    ]);\n\n    TargetManager.instance().observeModels(EventBreakpointsModel, this);\n  }\n\n  static instance(opts: {\n    forceNew: boolean|null,\n  } = {forceNew: null}): EventBreakpointsManager {\n    const {forceNew} = opts;\n    if (!eventBreakpointManagerInstance || forceNew) {\n      eventBreakpointManagerInstance = new EventBreakpointsManager();\n    }\n\n    return eventBreakpointManagerInstance;\n  }\n\n  private createInstrumentationBreakpoints(category: Category, instrumentationNames: InstrumentationNames[]): void {\n    for (const instrumentationName of instrumentationNames) {\n      this.#eventListenerBreakpointsInternal.push(new EventListenerBreakpoint(category, instrumentationName));\n    }\n  }\n\n  eventListenerBreakpoints(): EventListenerBreakpoint[] {\n    return this.#eventListenerBreakpointsInternal.slice();\n  }\n\n  resolveEventListenerBreakpoint({eventName}: EventListenerPausedDetailsAuxData): EventListenerBreakpoint|null {\n    if (!eventName.startsWith(EventListenerBreakpoint.instrumentationPrefix)) {\n      return null;\n    }\n\n    const instrumentationName = eventName.substring(EventListenerBreakpoint.instrumentationPrefix.length);\n    return this.#eventListenerBreakpointsInternal.find(b => b.name === instrumentationName) || null;\n  }\n\n  modelAdded(eventBreakpointModel: EventBreakpointsModel): void {\n    for (const breakpoint of this.#eventListenerBreakpointsInternal) {\n      if (breakpoint.enabled()) {\n        breakpoint.updateOnModel(eventBreakpointModel);\n      }\n    }\n  }\n\n  modelRemoved(_eventBreakpointModel: EventBreakpointsModel): void {\n  }\n}\n\nSDKModel.register(EventBreakpointsModel, {capabilities: Capability.EVENT_BREAKPOINTS, autostart: false});\n"],
  "mappings": ";AAMA,SAAQ,uBAAuB,gBAAe;AAE9C,SAAQ,gBAAe;AACvB,SAAQ,kBAA8B;AACtC,SAA+B,qBAAoB;AAE5C,WAAW,uBAAX,kBAAWA,0BAAX;AACL,EAAAA,sBAAA,yCAAsC;AACtC,EAAAA,sBAAA,2CAAwC;AACxC,EAAAA,sBAAA,yCAAsC;AACtC,EAAAA,sBAAA,2CAAwC;AACxC,EAAAA,sBAAA,iBAAc;AACd,EAAAA,sBAAA,mBAAgB;AAChB,EAAAA,sBAAA,0BAAuB;AACvB,EAAAA,sBAAA,kBAAe;AACf,EAAAA,sBAAA,oBAAiB;AACjB,EAAAA,sBAAA,2BAAwB;AACxB,EAAAA,sBAAA,4BAAyB;AACzB,EAAAA,sBAAA,2BAAwB;AACxB,EAAAA,sBAAA,mDAAgD;AAChD,EAAAA,sBAAA,6BAA0B;AAC1B,EAAAA,sBAAA,4BAAyB;AACzB,EAAAA,sBAAA,sCAAmC;AACnC,EAAAA,sBAAA,uBAAoB;AACpB,EAAAA,sBAAA,yBAAsB;AACtB,EAAAA,sBAAA,4BAAyB;AACzB,EAAAA,sBAAA,4BAAyB;AACzB,EAAAA,sBAAA,sCAAmC;AACnC,EAAAA,sBAAA,gCAA6B;AAC7B,EAAAA,sBAAA,oCAAiC;AACjC,EAAAA,sBAAA,sBAAmB;AACnB,EAAAA,sBAAA,oBAAiB;AACjB,EAAAA,sBAAA,2BAAwB;AACxB,EAAAA,sBAAA,0BAAuB;AACvB,EAAAA,sBAAA,2BAAwB;AACxB,EAAAA,sBAAA,6BAA0B;AA7BV,SAAAA;AAAA,GAAA;AAgCX,aAAM,8BAA8B,SAAe;AAAA,EAC/C;AAAA,EAET,YAAY,QAAgB;AAC1B,UAAM,MAAM;AACZ,SAAK,QAAQ,OAAO,sBAAsB;AAAA,EAC5C;AACF;AAIA,MAAM,gCAAgC,sBAAsB;AAAA,EACjD,WAAW,SAAwB;AAC1C,QAAI,KAAK,QAAQ,MAAM,SAAS;AAC9B;AAAA,IACF;AACA,UAAM,WAAW,OAAO;AACxB,eAAW,SAAS,cAAc,SAAS,EAAE,OAAO,qBAAqB,GAAG;AAC1E,WAAK,cAAc,KAAK;AAAA,IAC1B;AAAA,EACF;AAAA,EAEA,cAAc,OAAoC;AAChD,QAAI,KAAK,QAAQ,GAAG;AAClB,WAAK,MAAM,MAAM,oCAAoC,EAAC,WAAW,KAAK,KAAI,CAAC;AAAA,IAC7E,OAAO;AACL,WAAK,MAAM,MAAM,uCAAuC,EAAC,WAAW,KAAK,KAAI,CAAC;AAAA,IAChF;AAAA,EACF;AAAA,EAEA,OAAgB,wBAAwB;AAC1C;AAEA,IAAI;AAEG,aAAM,wBAA2E;AAAA,EAC7E,oCAA+D,CAAC;AAAA,EAEzE,cAAc;AACZ,SAAK,iCAAiC,SAAS,iBAAiB;AAAA,MAC9D;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF,CAAC;AACD,SAAK,iCAAiC,SAAS,WAAW;AAAA,MACxD;AAAA,MACA;AAAA,MACA;AAAA,IACF,CAAC;AACD,SAAK,iCAAiC,SAAS,QAAQ;AAAA,MACrD;AAAA,MACA;AAAA,MACA;AAAA,IACF,CAAC;AACD,SAAK,iCAAiC,SAAS,aAAa;AAAA,MAC1D;AAAA,MACA;AAAA,IACF,CAAC;AACD,SAAK,iCAAiC,SAAS,cAAc;AAAA,MAC3D;AAAA,IACF,CAAC;AACD,SAAK,iCAAiC,SAAS,OAAO;AAAA,MACpD;AAAA,MACA;AAAA,IACF,CAAC;AACD,SAAK,iCAAiC,SAAS,QAAQ;AAAA,MACrD;AAAA,MACA;AAAA,IACF,CAAC;AACD,SAAK,iCAAiC,SAAS,wBAAwB;AAAA,MACrE;AAAA,IACF,CAAC;AACD,SAAK,iCAAiC,SAAS,OAAO;AAAA,MACpD;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF,CAAC;AACD,SAAK,iCAAiC,SAAS,QAAQ;AAAA,MACrD;AAAA,IACF,CAAC;AACD,SAAK,iCAAiC,SAAS,WAAW;AAAA,MACxD;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF,CAAC;AAED,kBAAc,SAAS,EAAE,cAAc,uBAAuB,IAAI;AAAA,EACpE;AAAA,EAEA,OAAO,SAAS,OAEZ,EAAC,UAAU,KAAI,GAA4B;AAC7C,UAAM,EAAC,SAAQ,IAAI;AACnB,QAAI,CAAC,kCAAkC,UAAU;AAC/C,uCAAiC,IAAI,wBAAwB;AAAA,IAC/D;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,iCAAiC,UAAoB,sBAAoD;AAC/G,eAAW,uBAAuB,sBAAsB;AACtD,WAAK,kCAAkC,KAAK,IAAI,wBAAwB,UAAU,mBAAmB,CAAC;AAAA,IACxG;AAAA,EACF;AAAA,EAEA,2BAAsD;AACpD,WAAO,KAAK,kCAAkC,MAAM;AAAA,EACtD;AAAA,EAEA,+BAA+B,EAAC,UAAS,GAAoE;AAC3G,QAAI,CAAC,UAAU,WAAW,wBAAwB,qBAAqB,GAAG;AACxE,aAAO;AAAA,IACT;AAEA,UAAM,sBAAsB,UAAU,UAAU,wBAAwB,sBAAsB,MAAM;AACpG,WAAO,KAAK,kCAAkC,KAAK,OAAK,EAAE,SAAS,mBAAmB,KAAK;AAAA,EAC7F;AAAA,EAEA,WAAW,sBAAmD;AAC5D,eAAW,cAAc,KAAK,mCAAmC;AAC/D,UAAI,WAAW,QAAQ,GAAG;AACxB,mBAAW,cAAc,oBAAoB;AAAA,MAC/C;AAAA,IACF;AAAA,EACF;AAAA,EAEA,aAAa,uBAAoD;AAAA,EACjE;AACF;AAEA,SAAS,SAAS,uBAAuB,EAAC,cAAc,WAAW,mBAAmB,WAAW,MAAK,CAAC;",
  "names": ["InstrumentationNames"]
}
