{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/core/sdk/CSSStyleSheetHeader.ts"],
  "sourcesContent": ["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as Common from '../common/common.js';\nimport * as i18n from '../i18n/i18n.js';\nimport * as Platform from '../platform/platform.js';\nimport * as Root from '../root/root.js';\n\nimport type {CSSModel} from './CSSModel.js';\nimport {DeferredDOMNode} from './DOMModel.js';\nimport type {FrameAssociated} from './FrameAssociated.js';\nimport type {PageResourceLoadInitiator} from './PageResourceLoader.js';\nimport {ResourceTreeModel} from './ResourceTreeModel.js';\n\nconst UIStrings = {\n  /**\n   *@description Error message for when a CSS file can't be loaded\n   */\n  couldNotFindTheOriginalStyle: 'Could not find the original style sheet.',\n  /**\n   *@description Error message to display when a source CSS file could not be retrieved.\n   */\n  thereWasAnErrorRetrievingThe: 'There was an error retrieving the source styles.',\n};\nconst str_ = i18n.i18n.registerUIStrings('core/sdk/CSSStyleSheetHeader.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class CSSStyleSheetHeader implements TextUtils.ContentProvider.ContentProvider, FrameAssociated {\n  #cssModelInternal: CSSModel;\n  id: Protocol.CSS.StyleSheetId;\n  frameId: Protocol.Page.FrameId;\n  sourceURL: Platform.DevToolsPath.UrlString;\n  hasSourceURL: boolean;\n  origin: Protocol.CSS.StyleSheetOrigin;\n  title: string;\n  disabled: boolean;\n  isInline: boolean;\n  isMutable: boolean;\n  isConstructed: boolean;\n  startLine: number;\n  startColumn: number;\n  endLine: number;\n  endColumn: number;\n  contentLength: number;\n  ownerNode: DeferredDOMNode|undefined;\n  sourceMapURL: Platform.DevToolsPath.UrlString|undefined;\n  readonly loadingFailed: boolean;\n  #originalContentProviderInternal: TextUtils.StaticContentProvider.StaticContentProvider|null;\n\n  constructor(cssModel: CSSModel, payload: Protocol.CSS.CSSStyleSheetHeader) {\n    this.#cssModelInternal = cssModel;\n    this.id = payload.styleSheetId;\n    this.frameId = payload.frameId;\n    this.sourceURL = payload.sourceURL as Platform.DevToolsPath.UrlString;\n    this.hasSourceURL = Boolean(payload.hasSourceURL);\n    this.origin = payload.origin;\n    this.title = payload.title;\n    this.disabled = payload.disabled;\n    this.isInline = payload.isInline;\n    this.isMutable = payload.isMutable;\n    this.isConstructed = payload.isConstructed;\n    this.startLine = payload.startLine;\n    this.startColumn = payload.startColumn;\n    this.endLine = payload.endLine;\n    this.endColumn = payload.endColumn;\n    this.contentLength = payload.length;\n    if (payload.ownerNode) {\n      this.ownerNode = new DeferredDOMNode(cssModel.target(), payload.ownerNode);\n    }\n    this.sourceMapURL = payload.sourceMapURL as Platform.DevToolsPath.UrlString;\n    this.loadingFailed = payload.loadingFailed ?? false;\n    this.#originalContentProviderInternal = null;\n  }\n\n  originalContentProvider(): TextUtils.ContentProvider.ContentProvider {\n    if (!this.#originalContentProviderInternal) {\n      const lazyContent = (async(): Promise<TextUtils.ContentData.ContentDataOrError> => {\n        const originalText = await this.#cssModelInternal.originalStyleSheetText(this);\n        if (originalText === null) {\n          return {error: i18nString(UIStrings.couldNotFindTheOriginalStyle)};\n        }\n        return new TextUtils.ContentData.ContentData(originalText, /* isBase64=*/ false, 'text/css');\n      });\n      this.#originalContentProviderInternal =\n          new TextUtils.StaticContentProvider.StaticContentProvider(this.contentURL(), this.contentType(), lazyContent);\n    }\n    return this.#originalContentProviderInternal;\n  }\n\n  setSourceMapURL(sourceMapURL?: Platform.DevToolsPath.UrlString): void {\n    this.sourceMapURL = sourceMapURL;\n  }\n\n  cssModel(): CSSModel {\n    return this.#cssModelInternal;\n  }\n\n  isAnonymousInlineStyleSheet(): boolean {\n    return !this.resourceURL() && !this.#cssModelInternal.sourceMapManager().sourceMapForClient(this);\n  }\n\n  isConstructedByNew(): boolean {\n    return this.isConstructed && this.sourceURL.length === 0;\n  }\n\n  resourceURL(): Platform.DevToolsPath.UrlString {\n    const url = this.isViaInspector() ? this.viaInspectorResourceURL() : this.sourceURL;\n    if (!url && Root.Runtime.experiments.isEnabled(Root.Runtime.ExperimentName.STYLES_PANE_CSS_CHANGES)) {\n      return this.dynamicStyleURL();\n    }\n    return url;\n  }\n\n  private getFrameURLPath(): string {\n    const model = this.#cssModelInternal.target().model(ResourceTreeModel);\n    console.assert(Boolean(model));\n    if (!model) {\n      return '';\n    }\n    const frame = model.frameForId(this.frameId);\n    if (!frame) {\n      return '';\n    }\n    console.assert(Boolean(frame));\n    const parsedURL = new Common.ParsedURL.ParsedURL(frame.url);\n    let urlPath = parsedURL.host + parsedURL.folderPathComponents;\n    if (!urlPath.endsWith('/')) {\n      urlPath += '/';\n    }\n    return urlPath;\n  }\n\n  private viaInspectorResourceURL(): Platform.DevToolsPath.UrlString {\n    return `inspector://${this.getFrameURLPath()}inspector-stylesheet` as Platform.DevToolsPath.UrlString;\n  }\n\n  private dynamicStyleURL(): Platform.DevToolsPath.UrlString {\n    return `stylesheet://${this.getFrameURLPath()}style#${this.id}` as Platform.DevToolsPath.UrlString;\n  }\n\n  lineNumberInSource(lineNumberInStyleSheet: number): number {\n    return this.startLine + lineNumberInStyleSheet;\n  }\n\n  columnNumberInSource(lineNumberInStyleSheet: number, columnNumberInStyleSheet: number): number|undefined {\n    return (lineNumberInStyleSheet ? 0 : this.startColumn) + columnNumberInStyleSheet;\n  }\n\n  /**\n   * Checks whether the position is in this style sheet. Assumes that the\n   * position's columnNumber is consistent with line endings.\n   */\n  containsLocation(lineNumber: number, columnNumber: number): boolean {\n    const afterStart =\n        (lineNumber === this.startLine && columnNumber >= this.startColumn) || lineNumber > this.startLine;\n    const beforeEnd = lineNumber < this.endLine || (lineNumber === this.endLine && columnNumber <= this.endColumn);\n    return afterStart && beforeEnd;\n  }\n\n  contentURL(): Platform.DevToolsPath.UrlString {\n    return this.resourceURL();\n  }\n\n  contentType(): Common.ResourceType.ResourceType {\n    return Common.ResourceType.resourceTypes.Stylesheet;\n  }\n\n  requestContent(): Promise<TextUtils.ContentProvider.DeferredContent> {\n    return this.requestContentData().then(TextUtils.ContentData.ContentData.asDeferredContent.bind(undefined));\n  }\n\n  async requestContentData(): Promise<TextUtils.ContentData.ContentDataOrError> {\n    const cssText = await this.#cssModelInternal.getStyleSheetText(this.id);\n    if (cssText === null) {\n      return {error: i18nString(UIStrings.thereWasAnErrorRetrievingThe)};\n    }\n    return new TextUtils.ContentData.ContentData(cssText, /* isBase64=*/ false, 'text/css');\n  }\n\n  async searchInContent(query: string, caseSensitive: boolean, isRegex: boolean):\n      Promise<TextUtils.ContentProvider.SearchMatch[]> {\n    const contentData = await this.requestContentData();\n    return TextUtils.TextUtils.performSearchInContentData(contentData, query, caseSensitive, isRegex);\n  }\n\n  isViaInspector(): boolean {\n    return this.origin === 'inspector';\n  }\n\n  createPageResourceLoadInitiator(): PageResourceLoadInitiator {\n    return {\n      target: this.#cssModelInternal.target(),\n      frameId: this.frameId,\n      initiatorUrl: this.hasSourceURL ? Platform.DevToolsPath.EmptyUrlString : this.sourceURL,\n    };\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
