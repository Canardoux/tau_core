{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/models/bindings/DefaultScriptMapping.ts"],
  "sourcesContent": ["/*\n * Copyright (C) 2012 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../../core/common/common.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as TextUtils from '../text_utils/text_utils.js';\nimport * as Workspace from '../workspace/workspace.js';\n\nimport {ContentProviderBasedProject} from './ContentProviderBasedProject.js';\nimport type {DebuggerSourceMapping, DebuggerWorkspaceBinding} from './DebuggerWorkspaceBinding.js';\n\nexport class DefaultScriptMapping implements DebuggerSourceMapping {\n  readonly #debuggerWorkspaceBinding: DebuggerWorkspaceBinding;\n  readonly #project: ContentProviderBasedProject;\n  readonly #eventListeners: Common.EventTarget.EventDescriptor[];\n  readonly #uiSourceCodeToScript: Map<Workspace.UISourceCode.UISourceCode, SDK.Script.Script>;\n  readonly #scriptToUISourceCode: Map<SDK.Script.Script, Workspace.UISourceCode.UISourceCode>;\n\n  constructor(\n      debuggerModel: SDK.DebuggerModel.DebuggerModel, workspace: Workspace.Workspace.WorkspaceImpl,\n      debuggerWorkspaceBinding: DebuggerWorkspaceBinding) {\n    defaultScriptMappings.add(this);\n    this.#debuggerWorkspaceBinding = debuggerWorkspaceBinding;\n    this.#project = new ContentProviderBasedProject(\n        workspace, 'debugger:' + debuggerModel.target().id(), Workspace.Workspace.projectTypes.Debugger, '',\n        true /* isServiceProject */);\n    this.#eventListeners = [\n      debuggerModel.addEventListener(SDK.DebuggerModel.Events.GlobalObjectCleared, this.globalObjectCleared, this),\n      debuggerModel.addEventListener(SDK.DebuggerModel.Events.ParsedScriptSource, this.parsedScriptSource, this),\n      debuggerModel.addEventListener(\n          SDK.DebuggerModel.Events.DiscardedAnonymousScriptSource, this.discardedScriptSource, this),\n    ];\n    this.#uiSourceCodeToScript = new Map();\n    this.#scriptToUISourceCode = new Map();\n  }\n\n  static createV8ScriptURL(script: SDK.Script.Script): Platform.DevToolsPath.UrlString {\n    const name = Common.ParsedURL.ParsedURL.extractName(script.sourceURL);\n    const url = 'debugger:///VM' + script.scriptId + (name ? ' ' + name : '') as Platform.DevToolsPath.UrlString;\n    return url;\n  }\n\n  static scriptForUISourceCode(uiSourceCode: Workspace.UISourceCode.UISourceCode): SDK.Script.Script|null {\n    for (const defaultScriptMapping of defaultScriptMappings) {\n      const script = defaultScriptMapping.#uiSourceCodeToScript.get(uiSourceCode);\n      if (script !== undefined) {\n        return script;\n      }\n    }\n    return null;\n  }\n\n  uiSourceCodeForScript(script: SDK.Script.Script): Workspace.UISourceCode.UISourceCode|null {\n    return this.#scriptToUISourceCode.get(script) ?? null;\n  }\n\n  rawLocationToUILocation(rawLocation: SDK.DebuggerModel.Location): Workspace.UISourceCode.UILocation|null {\n    const script = rawLocation.script();\n    if (!script) {\n      return null;\n    }\n    const uiSourceCode = this.#scriptToUISourceCode.get(script);\n    if (!uiSourceCode) {\n      return null;\n    }\n    const {lineNumber, columnNumber} = script.rawLocationToRelativeLocation(rawLocation);\n    return uiSourceCode.uiLocation(lineNumber, columnNumber);\n  }\n\n  uiLocationToRawLocations(\n      uiSourceCode: Workspace.UISourceCode.UISourceCode, lineNumber: number,\n      columnNumber?: number): SDK.DebuggerModel.Location[] {\n    const script = this.#uiSourceCodeToScript.get(uiSourceCode);\n    if (!script) {\n      return [];\n    }\n    ({lineNumber, columnNumber} = script.relativeLocationToRawLocation({lineNumber, columnNumber}));\n    return [script.debuggerModel.createRawLocation(script, lineNumber, columnNumber ?? 0)];\n  }\n\n  uiLocationRangeToRawLocationRanges(\n      uiSourceCode: Workspace.UISourceCode.UISourceCode,\n      {startLine, startColumn, endLine, endColumn}: TextUtils.TextRange.TextRange):\n      SDK.DebuggerModel.LocationRange[]|null {\n    const script = this.#uiSourceCodeToScript.get(uiSourceCode);\n    if (!script) {\n      return [];\n    }\n    ({lineNumber: startLine, columnNumber: startColumn} =\n         script.relativeLocationToRawLocation({lineNumber: startLine, columnNumber: startColumn}));\n    ({lineNumber: endLine, columnNumber: endColumn} =\n         script.relativeLocationToRawLocation({lineNumber: endLine, columnNumber: endColumn}));\n    const start = script.debuggerModel.createRawLocation(script, startLine, startColumn);\n    const end = script.debuggerModel.createRawLocation(script, endLine, endColumn);\n    return [{start, end}];\n  }\n\n  private parsedScriptSource(event: Common.EventTarget.EventTargetEvent<SDK.Script.Script>): void {\n    const script = event.data;\n    const url = DefaultScriptMapping.createV8ScriptURL(script);\n\n    const uiSourceCode = this.#project.createUISourceCode(url, Common.ResourceType.resourceTypes.Script);\n    if (script.isBreakpointCondition) {\n      uiSourceCode.markAsUnconditionallyIgnoreListed();\n    }\n    this.#uiSourceCodeToScript.set(uiSourceCode, script);\n    this.#scriptToUISourceCode.set(script, uiSourceCode);\n    this.#project.addUISourceCodeWithProvider(uiSourceCode, script, null, 'text/javascript');\n    void this.#debuggerWorkspaceBinding.updateLocations(script);\n  }\n\n  private discardedScriptSource(event: Common.EventTarget.EventTargetEvent<SDK.Script.Script>): void {\n    const script = event.data;\n    const uiSourceCode = this.#scriptToUISourceCode.get(script);\n    if (uiSourceCode === undefined) {\n      return;\n    }\n    this.#scriptToUISourceCode.delete(script);\n    this.#uiSourceCodeToScript.delete(uiSourceCode);\n    this.#project.removeUISourceCode(uiSourceCode.url());\n  }\n\n  private globalObjectCleared(): void {\n    this.#scriptToUISourceCode.clear();\n    this.#uiSourceCodeToScript.clear();\n    this.#project.reset();\n  }\n\n  dispose(): void {\n    defaultScriptMappings.delete(this);\n    Common.EventTarget.removeEventListeners(this.#eventListeners);\n    this.globalObjectCleared();\n    this.#project.dispose();\n  }\n}\n\n// TODO(bmeurer): Remove the static methods from DefaultScriptMapping\n// and get rid of this global table.\nconst defaultScriptMappings = new Set<DefaultScriptMapping>();\n"],
  "mappings": "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",
  "names": []
}
