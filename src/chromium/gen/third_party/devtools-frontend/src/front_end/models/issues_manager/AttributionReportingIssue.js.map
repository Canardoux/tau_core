{
  "version": 3,
  "sources": ["../../../../../../../../../third_party/devtools-frontend/src/front_end/models/issues_manager/AttributionReportingIssue.ts"],
  "sourcesContent": ["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\n\nimport {Issue, IssueCategory, IssueKind} from './Issue.js';\nimport type {MarkdownIssueDescription} from './MarkdownIssueDescription.js';\n\nexport const enum IssueCode {\n  PERMISSION_POLICY_DISABLED = 'AttributionReportingIssue::PermissionPolicyDisabled',\n  UNTRUSTWORTHY_REPORTING_ORIGIN = 'AttributionReportingIssue::UntrustworthyReportingOrigin',\n  INSECURE_CONTEXT = 'AttributionReportingIssue::InsecureContext',\n  INVALID_REGISTER_SOURCE_HEADER = 'AttributionReportingIssue::InvalidRegisterSourceHeader',\n  INVALID_REGISTER_TRIGGER_HEADER = 'AttributionReportingIssue::InvalidRegisterTriggerHeader',\n  SOURCE_AND_TRIGGER_HEADERS = 'AttributionReportingIssue::SourceAndTriggerHeaders',\n  SOURCE_IGNORED = 'AttributionReportingIssue::SourceIgnored',\n  TRIGGER_IGNORED = 'AttributionReportingIssue::TriggerIgnored',\n  OS_SOURCE_IGNORED = 'AttributionReportingIssue::OsSourceIgnored',\n  OS_TRIGGER_IGNORED = 'AttributionReportingIssue::OsTriggerIgnored',\n  INVALID_REGISTER_OS_SOURCE_HEADER = 'AttributionReportingIssue::InvalidRegisterOsSourceHeader',\n  INVALID_REGISTER_OS_TRIGGER_HEADER = 'AttributionReportingIssue::InvalidRegisterOsTriggerHeader',\n  WEB_AND_OS_HEADERS = 'AttributionReportingIssue::WebAndOsHeaders',\n  NO_WEB_OR_OS_SUPPORT = 'AttributionReportingIssue::NoWebOrOsSupport',\n  NAVIGATION_REGISTRATION_WITHOUT_TRANSIENT_USER_ACTIVATION =\n      'AttributionReportingIssue::NavigationRegistrationWithoutTransientUserActivation',\n  INVALID_INFO_HEADER = 'AttributionReportingIssue::InvalidInfoHeader',\n  NO_REGISTER_SOURCE_HEADER = 'AttributionReportingIssue::NoRegisterSourceHeader',\n  NO_REGISTER_TRIGGER_HEADER = 'AttributionReportingIssue::NoRegisterTriggerHeader',\n  NO_REGISTER_OS_SOURCE_HEADER = 'AttributionReportingIssue::NoRegisterOsSourceHeader',\n  NO_REGISTER_OS_TRIGGER_HEADER = 'AttributionReportingIssue::NoRegisterOsTriggerHeader',\n  NAVIGATION_REGISTRATION_UNIQUE_SCOPE_ALREADY_SET =\n      'AttributionReportingIssue::NavigationRegistrationUniqueScopeAlreadySet',\n  UNKNOWN = 'AttributionReportingIssue::Unknown',\n}\n\nfunction getIssueCode(details: Protocol.Audits.AttributionReportingIssueDetails): IssueCode {\n  switch (details.violationType) {\n    case Protocol.Audits.AttributionReportingIssueType.PermissionPolicyDisabled:\n      return IssueCode.PERMISSION_POLICY_DISABLED;\n    case Protocol.Audits.AttributionReportingIssueType.UntrustworthyReportingOrigin:\n      return IssueCode.UNTRUSTWORTHY_REPORTING_ORIGIN;\n    case Protocol.Audits.AttributionReportingIssueType.InsecureContext:\n      return IssueCode.INSECURE_CONTEXT;\n    case Protocol.Audits.AttributionReportingIssueType.InvalidHeader:\n      return IssueCode.INVALID_REGISTER_SOURCE_HEADER;\n    case Protocol.Audits.AttributionReportingIssueType.InvalidRegisterTriggerHeader:\n      return IssueCode.INVALID_REGISTER_TRIGGER_HEADER;\n    case Protocol.Audits.AttributionReportingIssueType.SourceAndTriggerHeaders:\n      return IssueCode.SOURCE_AND_TRIGGER_HEADERS;\n    case Protocol.Audits.AttributionReportingIssueType.SourceIgnored:\n      return IssueCode.SOURCE_IGNORED;\n    case Protocol.Audits.AttributionReportingIssueType.TriggerIgnored:\n      return IssueCode.TRIGGER_IGNORED;\n    case Protocol.Audits.AttributionReportingIssueType.OsSourceIgnored:\n      return IssueCode.OS_SOURCE_IGNORED;\n    case Protocol.Audits.AttributionReportingIssueType.OsTriggerIgnored:\n      return IssueCode.OS_TRIGGER_IGNORED;\n    case Protocol.Audits.AttributionReportingIssueType.InvalidRegisterOsSourceHeader:\n      return IssueCode.INVALID_REGISTER_OS_SOURCE_HEADER;\n    case Protocol.Audits.AttributionReportingIssueType.InvalidRegisterOsTriggerHeader:\n      return IssueCode.INVALID_REGISTER_OS_TRIGGER_HEADER;\n    case Protocol.Audits.AttributionReportingIssueType.WebAndOsHeaders:\n      return IssueCode.WEB_AND_OS_HEADERS;\n    case Protocol.Audits.AttributionReportingIssueType.NoWebOrOsSupport:\n      return IssueCode.NO_WEB_OR_OS_SUPPORT;\n    case Protocol.Audits.AttributionReportingIssueType.NavigationRegistrationWithoutTransientUserActivation:\n      return IssueCode.NAVIGATION_REGISTRATION_WITHOUT_TRANSIENT_USER_ACTIVATION;\n    case Protocol.Audits.AttributionReportingIssueType.InvalidInfoHeader:\n      return IssueCode.INVALID_INFO_HEADER;\n    case Protocol.Audits.AttributionReportingIssueType.NoRegisterSourceHeader:\n      return IssueCode.NO_REGISTER_SOURCE_HEADER;\n    case Protocol.Audits.AttributionReportingIssueType.NoRegisterTriggerHeader:\n      return IssueCode.NO_REGISTER_TRIGGER_HEADER;\n    case Protocol.Audits.AttributionReportingIssueType.NoRegisterOsSourceHeader:\n      return IssueCode.NO_REGISTER_OS_SOURCE_HEADER;\n    case Protocol.Audits.AttributionReportingIssueType.NoRegisterOsTriggerHeader:\n      return IssueCode.NO_REGISTER_OS_TRIGGER_HEADER;\n    case Protocol.Audits.AttributionReportingIssueType.NavigationRegistrationUniqueScopeAlreadySet:\n      return IssueCode.NAVIGATION_REGISTRATION_UNIQUE_SCOPE_ALREADY_SET;\n    default:\n      return IssueCode.UNKNOWN;\n  }\n}\n\nconst structuredHeaderLink = {\n  link: 'https://tools.ietf.org/id/draft-ietf-httpbis-header-structure-15.html#rfc.section.4.2.2',\n  linkTitle: 'Structured Headers RFC',\n};\n\nexport class AttributionReportingIssue extends Issue<IssueCode> {\n  issueDetails: Readonly<Protocol.Audits.AttributionReportingIssueDetails>;\n\n  constructor(\n      issueDetails: Protocol.Audits.AttributionReportingIssueDetails, issuesModel: SDK.IssuesModel.IssuesModel) {\n    super(getIssueCode(issueDetails), issuesModel);\n    this.issueDetails = issueDetails;\n  }\n\n  getCategory(): IssueCategory {\n    return IssueCategory.ATTRIBUTION_REPORTING;\n  }\n\n  getHeaderValidatorLink(name: string): {link: string, linkTitle: string} {\n    const url = new URL('https://wicg.github.io/attribution-reporting-api/validate-headers');\n    url.searchParams.set('header', name);\n\n    if (this.issueDetails.invalidParameter) {\n      url.searchParams.set('json', this.issueDetails.invalidParameter);\n    }\n\n    return {\n      link: url.toString(),\n      linkTitle: 'Header Validator',\n    };\n  }\n\n  getDescription(): MarkdownIssueDescription|null {\n    switch (this.code()) {\n      case IssueCode.PERMISSION_POLICY_DISABLED:\n        return {\n          file: 'arPermissionPolicyDisabled.md',\n          links: [],\n        };\n      case IssueCode.UNTRUSTWORTHY_REPORTING_ORIGIN:\n        return {\n          file: 'arUntrustworthyReportingOrigin.md',\n          links: [],\n        };\n      case IssueCode.INSECURE_CONTEXT:\n        return {\n          file: 'arInsecureContext.md',\n          links: [],\n        };\n      case IssueCode.INVALID_REGISTER_SOURCE_HEADER:\n        return {\n          file: 'arInvalidRegisterSourceHeader.md',\n          links: [this.getHeaderValidatorLink('source')],\n        };\n      case IssueCode.INVALID_REGISTER_TRIGGER_HEADER:\n        return {\n          file: 'arInvalidRegisterTriggerHeader.md',\n          links: [this.getHeaderValidatorLink('trigger')],\n        };\n      case IssueCode.INVALID_REGISTER_OS_SOURCE_HEADER:\n        return {\n          file: 'arInvalidRegisterOsSourceHeader.md',\n          links: [this.getHeaderValidatorLink('os-source')],\n        };\n      case IssueCode.INVALID_REGISTER_OS_TRIGGER_HEADER:\n        return {\n          file: 'arInvalidRegisterOsTriggerHeader.md',\n          links: [this.getHeaderValidatorLink('os-trigger')],\n        };\n      case IssueCode.SOURCE_AND_TRIGGER_HEADERS:\n        return {\n          file: 'arSourceAndTriggerHeaders.md',\n          links: [],\n        };\n      case IssueCode.WEB_AND_OS_HEADERS:\n        return {\n          file: 'arWebAndOsHeaders.md',\n          links: [],\n        };\n      case IssueCode.SOURCE_IGNORED:\n        return {\n          file: 'arSourceIgnored.md',\n          links: [structuredHeaderLink],\n        };\n      case IssueCode.TRIGGER_IGNORED:\n        return {\n          file: 'arTriggerIgnored.md',\n          links: [structuredHeaderLink],\n        };\n      case IssueCode.OS_SOURCE_IGNORED:\n        return {\n          file: 'arOsSourceIgnored.md',\n          links: [structuredHeaderLink],\n        };\n      case IssueCode.OS_TRIGGER_IGNORED:\n        return {\n          file: 'arOsTriggerIgnored.md',\n          links: [structuredHeaderLink],\n        };\n      case IssueCode.NAVIGATION_REGISTRATION_WITHOUT_TRANSIENT_USER_ACTIVATION:\n        return {\n          file: 'arNavigationRegistrationWithoutTransientUserActivation.md',\n          links: [],\n        };\n      case IssueCode.NO_WEB_OR_OS_SUPPORT:\n        return {\n          file: 'arNoWebOrOsSupport.md',\n          links: [],\n        };\n      case IssueCode.INVALID_INFO_HEADER:\n        return {\n          file: 'arInvalidInfoHeader.md',\n          links: [],\n        };\n      case IssueCode.NO_REGISTER_SOURCE_HEADER:\n        return {\n          file: 'arNoRegisterSourceHeader.md',\n          links: [],\n        };\n      case IssueCode.NO_REGISTER_TRIGGER_HEADER:\n        return {\n          file: 'arNoRegisterTriggerHeader.md',\n          links: [],\n        };\n      case IssueCode.NO_REGISTER_OS_SOURCE_HEADER:\n        return {\n          file: 'arNoRegisterOsSourceHeader.md',\n          links: [],\n        };\n      case IssueCode.NO_REGISTER_OS_TRIGGER_HEADER:\n        return {\n          file: 'arNoRegisterOsTriggerHeader.md',\n          links: [],\n        };\n      case IssueCode.NAVIGATION_REGISTRATION_UNIQUE_SCOPE_ALREADY_SET:\n        return {\n          file: 'arNavigationRegistrationUniqueScopeAlreadySet.md',\n          links: [],\n        };\n      case IssueCode.UNKNOWN:\n        return null;\n    }\n  }\n\n  primaryKey(): string {\n    return JSON.stringify(this.issueDetails);\n  }\n\n  getKind(): IssueKind {\n    return IssueKind.PAGE_ERROR;\n  }\n\n  static fromInspectorIssue(issuesModel: SDK.IssuesModel.IssuesModel, inspectorIssue: Protocol.Audits.InspectorIssue):\n      AttributionReportingIssue[] {\n    const {attributionReportingIssueDetails} = inspectorIssue.details;\n    if (!attributionReportingIssueDetails) {\n      console.warn('Attribution Reporting issue without details received.');\n      return [];\n    }\n    return [new AttributionReportingIssue(attributionReportingIssueDetails, issuesModel)];\n  }\n}\n"],
  "mappings": "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",
  "names": ["IssueCode"]
}
